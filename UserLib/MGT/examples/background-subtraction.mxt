max v2;#N vpatcher 344 163 715 630;#P origin 62 -40;#P toggle 229 264 15 0;#P user jit.pwindow 178 305 162 122 0 1 0 0 1 0;#P window setfont "Sans Serif" 9.;#N vpatcher 127 44 1083 800;#P origin 0 121;#P window setfont "Sans Serif" 9.;#P window linecount 1;#P comment 567 723 100 196617 Output foreground;#P comment 398 723 100 196617 Foreground mask;#P comment 229 723 100 196617 Recorded background;#P user jit.pwindow 566 596 162 122 0 1 0 0 1 0;#P user jit.pwindow 397 596 162 122 0 1 0 0 1 0;#P user jit.pwindow 228 596 162 122 0 1 0 0 1 0;#P user jit.pwindow 58 596 162 122 0 1 0 0 1 0;#P comment 389 43 243 196617 Reducing the size of the matrix to save some power;#P comment 389 66 204 196617 Changing colour space used for calculations;#P window linecount 0;#P comment 339 355 149 196617 Converting back to char;#P newex 192 355 125 196617 jit.matrix 1 char 160 120;#P flonum 294 308 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P flonum 453 206 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P message 453 228 73 196617 slide_down \$1;#P flonum 390 206 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P message 390 228 60 196617 slide_up \$1;#P newex 267 254 190 196617 jit.slide @slide_up 10. @slide_down 10.;#P inlet 314 21 15 0;#P user com 564 162 97 196617 30;#K set 0 21608 26995 8304 24948 25448 8297 29472 25185 29541 25632 25185 29541 25632 28526 8289 8304 24948 25448 8290 31008 19045 24942 11597 24946 25376 20581 27756 25972 26981 29184;#K end;#P window linecount 3;#P comment 274 469 93 196617 Multiply input image by foreground mask.;#P window linecount 1;#P comment 331 412 52 196617 Threshold;#P window linecount 3;#P comment 401 390 143 196617 <- Blur followed by a threshold gets rid of some noise and smoothes the image.;#P window linecount 1;#P comment 285 284 115 196617 Input - background mean;#P comment 339 327 189 196617 Foreground mask before noise reduction;#P comment 389 117 119 196617 Using float for accuracy;#P number 291 411 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P newex 192 505 74 196617 jit.op @op *;#P newex 192 482 64 196617 jit.matrix in;#P newex 192 460 74 196617 t b l;#P newex 192 431 109 196617 jit.op @op > @val 100;#P newex 192 383 145 196617 jit.fastblur @range 3 @mode 4;#P newex 199 88 66 196617 jit.unpack;#P newex 199 66 178 196617 jit.colorspace @input rgb @output YIQ;#P newex 192 327 112 196617 jit.op @op > @val 0.05;#P newex 227 117 140 196617 jit.matrix 1 float32 160 120;#P newex 192 284 85 196617 jit.op @op absdiff;#P window linecount 2;#P comment 342 147 127 196617 0: Record background info. 1: Identify foreground;#P toggle 314 147 15 0;#P window linecount 1;#P newex 192 169 27 196617 + 1;#P newex 192 190 45 196617 gate 2 1;#P newex 199 43 138 196617 jit.matrix in 4 char 160 120;#P comment 305 434 85 196617 Foreground mask;#P outlet 192 540 15 0;#P inlet 199 21 15 0;#P window linecount 2;#P comment 467 257 143 196617 Adding an IIR filter to smooth out the background image.;#P window linecount 0;#P comment 59 723 100 196617 Input video;#P hidden connect 5 0 39 0;#P fasten 8 0 7 0 319 167 197 167;#P connect 7 0 6 0;#P connect 6 1 10 0;#P lcolor 8;#P connect 10 0 12 0;#P connect 12 0 35 0;#P connect 35 0 15 0;#P connect 15 0 16 0;#P connect 16 0 17 0;#P connect 17 0 18 0;#P connect 18 0 19 0;#P connect 19 0 3 0;#P connect 2 0 5 0;#P connect 5 0 13 0;#P connect 13 0 14 0;#P connect 14 2 11 0;#P connect 11 0 6 1;#P hidden connect 29 0 40 0;#P connect 17 1 19 1;#P fasten 30 0 29 0 395 248 272 248;#P fasten 32 0 29 0 458 252 272 252;#P connect 6 0 29 0;#P connect 29 0 10 1;#P connect 20 0 16 1;#P lcolor 1;#P connect 34 0 12 1;#P connect 28 0 8 0;#P connect 31 0 30 0;#P hidden connect 16 0 41 0;#P connect 33 0 32 0;#P hidden connect 19 0 42 0;#P pop;#P newobj 179 285 60 196617 p statistics;#P bpatcher 8 81 255 60 0 0 jmod.orsize%.mxt 0 /motion%;#P objectname /orsize%;#P bpatcher 8 141 255 60 0 0 jmod.brcosa%.mxt 0 /motion%;#P objectname /brcosa%;#P bpatcher 8 21 255 60 0 0 jmod.input%.mxt 0 /input%;#P objectname /input%;#P user jit.fpsgui 205 217 60 196617 0;#P toggle 65 264 15 0;#N vpatcher 215 44 757 407;#P origin -73 0;#P window setfont "Sans Serif" 9.;#P window linecount 1;#P comment 248 155 102 196617 Subtract background;#P comment 265 80 90 196617 Record background;#P comment 429 125 90 196617 Background image;#P comment 351 311 100 196617 Recorded background;#P comment 182 311 100 196617 Removed background;#P user jit.pwindow 10 184 162 122 0 1 0 0 1 0;#P user jit.pwindow 350 183 162 122 0 1 0 0 1 0;#P user jit.pwindow 181 183 162 122 0 1 0 0 1 0;#P newex 235 121 190 196617 jit.slide @slide_up 10. @slide_down 10.;#P inlet 235 24 15 0;#P toggle 235 79 15 0;#P window linecount 0;#P newex 235 98 27 196617 gate;#P hidden outlet 163 179 15 0;#P inlet 182 24 15 0;#P newex 182 151 63 196617 jit.op @op -;#P comment 11 311 100 196617 Original video;#P fasten 2 0 10 0 187 86 16 86;#P hidden connect 1 0 3 0;#P connect 2 0 1 0;#P connect 1 0 8 0;#P hidden connect 6 0 5 0;#P connect 5 0 4 0;#P connect 4 0 7 0;#P connect 7 0 1 1;#P fasten 2 0 4 1 187 73 257 73;#P fasten 7 0 9 0 240 144 356 144;#P pop;#P newobj 8 284 68 196617 p subtraction;#P hidden newex 8 227 128 196617 jit.matrix 4 char 320 240;#P user jit.pwindow 7 304 162 122 0 1 0 0 1 0;#P hidden fasten 6 1 1 0 258 209 13 209;#P hidden fasten 1 0 2 0 13 256 13 256;#P connect 2 0 0 0;#P connect 3 0 2 1;#P hidden fasten 1 0 8 0 13 256 184 256;#P connect 8 0 9 0;#P fasten 6 1 4 0 258 209 210 209;#P connect 10 0 8 1;#P hidden connect 5 1 7 1;#P hidden connect 7 1 6 1;#P pop;