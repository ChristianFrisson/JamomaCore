max v2;
#N vpatcher 90 242 1106 894;
#P origin -28 -10;
#P window setfont "Sans Serif" 9.;
#P newex 300 299 285 9109513 jcom.return data @description "data output in FTM format";
#N vpatcher 15 55 615 455;
#N comlet Segment beginning;
#P outlet 211 259 15 0;
#N comlet Segment end;
#P outlet 268 259 15 0;
#P objectname Segment;
#N comlet Speed;
#P outlet 325 259 15 0;
#P window setfont "Sans Serif" 9.;
#P window linecount 1;
#P message 411 156 33 9109513 locate;
#P message 411 138 29 9109513 next;
#P newex 40 81 354 9109513 jcom.oscroute /play /time /pause /beginning /end /speed;
#P inlet 40 47 15 0;
#P newex 154 146 54 9109513 sel 1 0;
#P message 187 169 26 9109513 play;
#P message 40 169 26 9109513 play;
#P newex 40 146 52 9109513 sel 1 0;
#P message 154 169 33 9109513 pause;
#P message 97 169 55 9109513 jump \$1;
#P message 66 169 26 9109513 stop;
#P outlet 40 259 15 0;
#P window linecount 0;
#P comment 408 109 138 9109513 control messages still to be implemented:;
#P connect 9 0 10 0;
#P connect 10 0 5 0;
#P connect 5 0 6 0;
#P fasten 7 0 1 0 192 222 45 222;
#P fasten 6 0 1 0 45 222 45 222;
#P fasten 2 0 1 0 71 222 45 222;
#P fasten 4 0 1 0 159 222 45 222;
#P fasten 3 0 1 0 102 222 45 222;
#P fasten 5 1 2 0 66 167 71 167;
#P connect 10 1 3 0;
#P connect 10 2 8 0;
#P connect 8 0 4 0;
#P fasten 8 1 7 0 181 167 192 167;
#P connect 10 3 15 0;
#P connect 10 4 14 0;
#P connect 10 5 13 0;
#P pop;
#P newobj 300 127 95 9109513 p player_controls;
#N vpatcher 974 483 1574 883;
#P window setfont "Sans Serif" 9.;
#P window linecount 1;
#P newex 355 58 52 9109513 r macwin;
#P message 370 99 14 9109513 1;
#P message 355 99 14 9109513 0;
#P newex 355 78 41 9109513 sel 1 0;
#P newex 32 72 52 9109513 r macwin;
#N vpatcher 10 59 610 459;
#P inlet 88 73 15 0;
#P window setfont "Sans Serif" 9.;
#P message 193 128 32 9109513 XVSY;
#P message 158 128 33 9109513 XEMG;
#P message 123 128 31 9109513 XPOL;
#P message 88 128 31 9109513 XXYZ;
#P newex 88 97 66 9109513 sel 0 1 2 3;
#P outlet 88 162 15 0;
#P connect 6 0 1 0;
#P connect 1 0 2 0;
#P connect 2 0 0 0;
#P connect 3 0 0 0;
#P connect 4 0 0 0;
#P connect 5 0 0 0;
#P connect 1 1 3 0;
#P connect 1 2 4 0;
#P connect 1 3 5 0;
#P pop;
#P newobj 46 188 85 9109513 p win-simulation;
#P newex 46 110 42 9109513 gate 1 0;
#P newex 207 174 47 9109513 gate 1 1;
#P outlet 207 305 15 0;
#P inlet 244 75 15 0;
#P inlet 301 75 15 0;
#P newex 264 132 47 9109513 gate 1 1;
#P user ftm.mess 264 161 66 15 3 9 255 255 255 0 0 0 1 2 0 0 --> 1;
#T _#ftm version 2 2;
#T _#scope begin;
#T _#absargs $0_ $1_ $2_ $3_ $4_ $5_ $6_ $7_ $8_ $9_;
#T _#line "_set $1\, bang";
#P user ftm.mess 207 236 54 15 139 9 255 255 255 0 0 0 1 2 0 0 --> 1;
#T _#line "_$2 [$1 0]";
#N ftm.sdif.info --> 1;
#P newobj 264 187 66 9109513 ftm.sdif.info;
#P window linecount 5;
#P comment 332 129 100 9109513 this should really be done as in this box \, but due to windows problems I use a simple simulation;
#P user panel 201 116 236 147;
#X brgb 191 191 191;
#X frgb 0 0 0;
#X border 0;
#X rounded 0;
#X shadow 0;
#X done;
#P connect 12 0 10 0;
#P connect 10 0 11 0;
#P fasten 7 0 10 1 249 100 83 100;
#P connect 14 0 9 0;
#P connect 15 0 9 0;
#P connect 9 0 3 0;
#P connect 11 0 8 0;
#P connect 3 0 8 0;
#P connect 7 0 9 1;
#P connect 2 1 3 1;
#P connect 15 0 5 0;
#P connect 14 0 5 0;
#P connect 5 0 4 0;
#P connect 4 0 2 0;
#P connect 6 0 5 1;
#P connect 16 0 13 0;
#P connect 13 0 14 0;
#P connect 13 1 15 0;
#P pop;
#P newobj 79 142 140 9109513 p get_chosen_stream_name;
#P message 386 187 14 9109513 0;
#P newex 386 208 381 9109513 jcom.return play @description "Used to stop the player at the end of the SDIF file";
#P window linecount 3;
#P newex 343 236 190 9109513 jcom.return time @range 0. 1000000. @clipmode low @description "Current playing position (in milliseconds)";
#P window linecount 1;
#N vpatcher 436 220 1231 815;
#P origin 0 37;
#P window setfont "Sans Serif" 9.;
#P window linecount 1;
#P newex 192 398 52 9109513 r macwin;
#P message 207 439 14 9109513 1;
#P message 192 439 14 9109513 0;
#P newex 192 418 41 9109513 sel 1 0;
#P newex 146 214 47 9109513 gate 1 0;
#P newex 229 56 52 9109513 r macwin;
#P message 244 97 14 9109513 1;
#P message 229 97 14 9109513 0;
#P newex 229 76 41 9109513 sel 1 0;
#P newex 113 174 52 9109513 r macwin;
#P newex 241 489 47 9109513 gate 1 1;
#P inlet 183 81 15 0;
#N vpatcher 15 55 1029 707;
#P origin 14 83;
#P button 261 62 15 0;
#P inlet 243 0 15 0;
#P outlet 234 659 15 0;
#P window setfont "Sans Serif" 9.;
#P newex 86 255 33 9109513 del 50;
#P newex 86 169 33 9109513 del 50;
#P newex 86 212 33 9109513 del 50;
#P newex 495 169 33 9109513 del 50;
#P newex 495 126 33 9109513 del 50;
#P button 562 138 15 0;
#P message 562 165 28 9109513 clear;
#P newex 86 126 33 9109513 del 50;
#P message 317 192 183 9109513 append XXYZ (with 9 rows and 3 columns);
#P message 317 149 182 9109513 append 1MID (with 1 rows and 3 columns);
#P message 116 278 184 9109513 append XVSY (with 1 rows and 1 columns);
#P message 116 235 183 9109513 append XPOL (with 2 rows and 6 columns);
#P message 116 149 183 9109513 append XXYZ (with 9 rows and 3 columns);
#P message 116 192 185 9109513 append XEMG (with 2 rows and 1 columns);
#P newex 243 32 28 9109513 sel 1;
#P fasten 0 0 7 0 248 88 91 88;
#P connect 7 0 13 0;
#P connect 13 0 12 0;
#P connect 12 0 14 0;
#P fasten 7 0 2 0 91 147 121 147;
#P fasten 13 0 1 0 91 190 121 190;
#P fasten 12 0 3 0 91 233 121 233;
#P fasten 14 0 4 0 91 276 121 276;
#P connect 8 0 15 0;
#P connect 5 0 15 0;
#P connect 6 0 15 0;
#P connect 3 0 15 0;
#P connect 2 0 15 0;
#P connect 4 0 15 0;
#P connect 1 0 15 0;
#P connect 16 0 0 0;
#P connect 0 1 17 0;
#P fasten 10 0 5 0 500 147 322 147;
#P fasten 11 0 6 0 500 190 322 190;
#P fasten 17 0 10 0 266 87 500 87;
#P connect 10 0 11 0;
#P fasten 16 0 9 0 248 26 567 26;
#P connect 9 0 8 0;
#P pop;
#P newobj 146 282 73 9109513 p temporary;
#P outlet 146 525 15 0;
#P newex 241 124 47 9109513 gate 1 1;
#P window linecount 6;
#P comment 530 282 145 9109513 column number 7 gives matrix rows \, and column number 8 gives the matrix columns. in our case \, column number 7 is the number of sensors \, and column number 8 is DOF.;
#P window linecount 4;
#P comment 586 174 85 9109513 The ftm.sdif.info object does not work properly on Windows!!;
#P window linecount 9;
#P comment 411 261 109 9109513 The first column (0) of the matrix given by ftm.sdif.info holds the frame definitions. The contents of these cells are output one after another \, and sent to a sprintf-object which populates the ubumenu;
#P window linecount 2;
#P comment 404 230 151 9109513 number of rows equals number of streams in the SDIF file;
#P window linecount 4;
#P comment 425 167 100 9109513 ftm.sdif.info outputs a matrix with info on the data in the different streams;
#P window linecount 1;
#P newex 241 147 30 9109513 t s b;
#P message 319 306 13 9109513 0;
#P newex 269 282 43 9109513 t 1 l -1;
#P newex 247 329 52 9109513 metro 50;
#P newex 301 353 31 9109513 bline;
#P window linecount 2;
#P newex 301 404 146 9109513 sprintf append %s (with %i rows and %i columns);
#P window linecount 1;
#P message 464 415 33 9109513 clear;
#P user ftm.mess 301 385 148 15 3 9 255 255 255 0 0 0 1 2 0 0 --> 1;
#T _#line "_$2 [$1 0] $2 [$1 7] $2 [$1 8]";
#P button 306 170 15 0;
#P user ftm.mess 269 239 56 15 3 9 255 255 255 0 0 0 1 2 0 0 --> 1;
#T _#line "_($1 rows)";
#P message 269 260 37 9109513 \$1 \$1;
#P user ftm.mess 241 170 66 15 3 9 255 255 255 0 0 0 1 2 0 0 --> 1;
#T _#line "_set $1\, bang";
#N ftm.sdif.info --> 1;
#P newobj 241 196 66 9109513 ftm.sdif.info;
#P window linecount 5;
#P comment 572 78 100 9109513 This is how to populate an ubumenu according to the frame definitions in the SDIF file.;
#P user panel 245 259 279 209;
#X brgb 215 220 193;
#X frgb 0 0 0;
#X border 0;
#X rounded 0;
#X shadow 0;
#X done;
#P user panel 250 226 321 32;
#X brgb 193 220 212;
#X frgb 0 0 0;
#X border 0;
#X rounded 0;
#X shadow 0;
#X done;
#P user panel 233 160 342 57;
#X brgb 220 193 210;
#X frgb 0 0 0;
#X border 0;
#X rounded 0;
#X shadow 0;
#X done;
#P window linecount 3;
#P comment 300 36 263 9109513 For now I am using a simple predefined list \, that works with my SDIF test files to cope with the windows problems.. Everything should work fine on mac though.;
#P connect 28 0 33 0;
#P connect 33 0 25 0;
#P connect 25 0 24 0;
#P connect 27 0 24 0;
#P connect 26 0 33 1;
#P connect 37 0 34 0;
#P connect 34 0 35 0;
#P connect 34 1 36 0;
#P connect 32 0 29 0;
#P connect 29 0 30 0;
#P connect 31 0 23 0;
#P connect 30 0 23 0;
#P connect 23 0 17 0;
#P connect 17 0 6 0;
#P fasten 9 0 5 0 311 190 246 190;
#P connect 6 0 5 0;
#P connect 36 0 27 0;
#P connect 35 0 27 0;
#P connect 29 1 31 0;
#P connect 16 0 14 0;
#P fasten 15 0 14 0 274 314 252 314;
#P connect 5 1 8 0;
#P connect 8 0 7 0;
#P connect 7 0 15 0;
#P connect 26 0 23 1;
#P connect 12 0 27 1;
#P connect 11 0 27 1;
#P fasten 14 0 13 0 252 349 306 349;
#P connect 15 2 13 0;
#P fasten 15 1 13 0 290 309 306 309;
#P connect 13 0 10 0;
#P connect 10 0 12 0;
#P fasten 13 1 16 0 327 374 335 374 335 300 324 300;
#P fasten 5 1 10 1 274 221 367 221 367 379 444 379;
#P fasten 9 0 11 0 311 191 389 191 389 373 469 373;
#P fasten 17 1 11 0 266 167 389 167 389 373 469 373;
#P pop;
#P newobj 11 332 110 9109513 p get_stream_names;
#P outlet 11 386 15 0;
#P user ftm.mess 79 216 62 15 3 9 255 255 255 0 0 0 1 2 0 0 --> 0;
#T _#line "_($1 duration)";
#P window linecount 3;
#P newex 79 234 204 9109513 jcom.return duration @range 0. 1000000. @clipmode low @description "Size of the chosen SDIF stream (in milliseconds)";
#P user ftm.mess 79 177 114 15 3 9 255 255 255 0 0 0 1 2 0 0 --> 0;
#T _#line "_clear\, import $2 $1\, bang";
#P user ftm.object 79 195 59 18 3 9 --> 0;
#T _#obj 1 track fmat;
#T _#obj 2 sequence fmat;
#T _#mess 1 events _#2;
#T _#obj 3 sequence marker;
#T _#mess 1 markers _#3;
#T _#obj 4 sequence metric;
#T _#mess 1 metric _#4;
#T _#obj 5 sequence number;
#T _#mess 1 tempo _#5;
#T _#def 1 "_track fmat" track1 local;
#P window linecount 1;
#N ftm.play $track1 --> 0;
#T _#scope end;
#P newobj 300 157 96 9109513 ftm.play $track1;
#P newex 11 81 147 9109513 jcom.oscroute /file /stream;
#P inlet 11 42 15 0;
#P objectname inlet;
#P connect 0 0 1 0;
#P connect 1 0 8 0;
#P connect 8 0 7 0;
#P connect 1 1 12 0;
#P connect 12 0 4 0;
#P connect 4 0 3 0;
#P connect 3 0 6 0;
#P connect 6 0 5 0;
#P fasten 1 0 4 1 16 293 286 293 286 170 188 170;
#P fasten 1 0 12 1 16 293 286 293 286 135 214 135;
#P fasten 1 2 13 0 152 103 305 103;
#P connect 13 0 2 0;
#P connect 2 0 14 0;
#P connect 13 1 2 1;
#P connect 2 1 9 0;
#P connect 13 2 2 2;
#P connect 13 3 2 3;
#P connect 2 2 11 0;
#P connect 11 0 10 0;
#P pop;
