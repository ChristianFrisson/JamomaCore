<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Jamoma: /Users/tim/dev/Jamoma/SourceCode/MaxObjects/jcom.colorspace/jcom.colorspace.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>/Users/tim/dev/Jamoma/SourceCode/MaxObjects/jcom.colorspace/jcom.colorspace.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* </span>
<a name="l00002"></a>00002 <span class="comment"> * jcom.colorspace</span>
<a name="l00003"></a>00003 <span class="comment"> * External for Jamoma: colorspace conversion</span>
<a name="l00004"></a>00004 <span class="comment"> * By Tim Place, Copyright © 2002</span>
<a name="l00005"></a>00005 <span class="comment"> * </span>
<a name="l00006"></a>00006 <span class="comment"> * License: This code is licensed under the terms of the GNU LGPL</span>
<a name="l00007"></a>00007 <span class="comment"> * http://www.gnu.org/licenses/lgpl.html </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * History:</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * Ported to Jamoma from tap.colorspace by T. Lossius - 10 October 2006</span>
<a name="l00012"></a>00012 <span class="comment"> * Updated for Max 4.5 / TapTools 2.0 - 2 July 2004</span>
<a name="l00013"></a>00013 <span class="comment"> * Initial version T.Place - 16 January 2002</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * Conversion routines were from Luke Dubois' Percolate Nato externals:</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * 242.colorspace -- does colorspace conversion on an input image.</span>
<a name="l00018"></a>00018 <span class="comment"> * by r. luke dubois (luke@music.columbia.edu),</span>
<a name="l00019"></a>00019 <span class="comment"> * computer music center, columbia university, 2001.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * most of the color conversion routines in this software are taken from rafael santos'</span>
<a name="l00022"></a>00022 <span class="comment"> * color image processing toolkit.  the copyright below cites the original author.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * objects and source are provided without warranty of any kind, express or implied.</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> * Copyright (C) 1996, Rafael Santos.</span>
<a name="l00027"></a>00027 <span class="comment"> * Developed at the Ejima Lab / Department of Artificial Intelligence,</span>
<a name="l00028"></a>00028 <span class="comment"> * Kyushu Institute of Technology.</span>
<a name="l00029"></a>00029 <span class="comment"> */</span> 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include "Jamoma.h"</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">typedef</span> <span class="keyword">struct </span>x                                        <span class="comment">// Data structure for this object </span>
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036         Object          cs_ob;                          <span class="comment">// Must always be the first field; used by Max</span>
<a name="l00037"></a>00037         <span class="keywordtype">void</span>            *obex;                          <span class="comment">// Pointer to object extensions (for attributes)</span>
<a name="l00038"></a>00038         <span class="keywordtype">void</span>            *out1;                          <span class="comment">// Pointer to outlet. need one for each outlet </span>
<a name="l00039"></a>00039         <span class="keywordtype">void</span>            *out2;
<a name="l00040"></a>00040         <span class="keywordtype">void</span>            *out3;
<a name="l00041"></a>00041         <span class="keywordtype">void</span>            *inlets[2];                     <span class="comment">// proxy inlets</span>
<a name="l00042"></a>00042         t_symbol        *attr_mode;                     <span class="comment">// Attribute storage</span>
<a name="l00043"></a>00043         t_symbol        *attr_outputtype;
<a name="l00044"></a>00044         <span class="keywordtype">long</span>            attr_autopack;
<a name="l00045"></a>00045         Atom            outlist[4];                     <span class="comment">// used for sending lists out</span>
<a name="l00046"></a>00046         <span class="keywordtype">int</span>             val1, calc1;
<a name="l00047"></a>00047         <span class="keywordtype">int</span>                     val2, calc2;
<a name="l00048"></a>00048         <span class="keywordtype">int</span>                     val3, calc3;    
<a name="l00049"></a>00049 }t_cs;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">// Class Globals</span>
<a name="l00053"></a>00053 t_class         *this_class;                            <span class="comment">// Required. Global pointing to this class</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 t_symbol        *ps_no_transform, *ps_rgb2cmy, *ps_cmy2rgb, *ps_rgb2hsv, *ps_hsv2rgb,
<a name="l00056"></a>00056                         *ps_rgb2xyz, *ps_xyz2rgb, *ps_rgb2uvw, *ps_uvw2rgb, *ps_rgb2retinalcone,
<a name="l00057"></a>00057                         *ps_retinalcone2rgb, *ps_rgb2lab, *ps_lab2rgb, *ps_rgb2yiq, *ps_yiq2rgb,
<a name="l00058"></a>00058                         *ps_rgb2hls, *ps_hls2rgb, *ps_rgb2rgbcie, *ps_rgbcie2rgb,
<a name="l00059"></a>00059                         *ps_rgb2rgbsmpte, *ps_rgbsmpte2rgb, *ps_rgb2hsl, *ps_hsl2rgb;
<a name="l00060"></a>00060 t_symbol        *ps_split, *ps_packed;                  
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">// Prototypes for methods: need a method for each incoming message</span>
<a name="l00064"></a>00064 <span class="keywordtype">void</span> *cs_new(Symbol *msg, <span class="keywordtype">long</span> argc, Atom *argv);                       <span class="comment">// object creation method  </span>
<a name="l00065"></a>00065 <span class="keywordtype">void</span> cs_free(t_cs *x);
<a name="l00066"></a>00066 <span class="keywordtype">void</span> cs_bang(t_cs *x);                                                                          <span class="comment">// method for "bang" message </span>
<a name="l00067"></a>00067 <span class="keywordtype">void</span> cs_float(t_cs *x, <span class="keywordtype">double</span> value);                           <span class="comment">// method for "float" message</span>
<a name="l00068"></a>00068 <span class="keywordtype">void</span> cs_int(t_cs *x, <span class="keywordtype">long</span> value);                                       <span class="comment">// method for "int" message</span>
<a name="l00069"></a>00069 <span class="keywordtype">void</span> cs_assist(t_cs *x, <span class="keywordtype">void</span> *b, <span class="keywordtype">long</span> m, <span class="keywordtype">long</span> a, <span class="keywordtype">char</span> *s);      <span class="comment">// assistance messages</span>
<a name="l00070"></a>00070 <span class="keywordtype">void</span> cs_list(t_cs *x, Symbol *msg, <span class="keywordtype">long</span> argc, Atom *argv);      <span class="comment">// method for "list" message</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="keywordtype">void</span> no_transform(t_cs *x);
<a name="l00073"></a>00073 <span class="keywordtype">void</span> rgb2cmy (t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);    
<a name="l00074"></a>00074 <span class="keywordtype">void</span> cmy2rgb(t_cs *x, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> y);
<a name="l00075"></a>00075 <span class="keywordtype">void</span> rgb2hsv(t_cs *x, <span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue);
<a name="l00076"></a>00076 <span class="keywordtype">void</span> hsv2rgb(t_cs *x, <span class="keywordtype">int</span> hue, <span class="keywordtype">int</span> saturation, <span class="keywordtype">int</span> value);
<a name="l00077"></a>00077 <span class="keywordtype">void</span> rgb2xyz(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00078"></a>00078 <span class="keywordtype">void</span> xyz2rgb(t_cs *x, <span class="keywordtype">int</span> xx, <span class="keywordtype">int</span> xy, <span class="keywordtype">int</span> xz);
<a name="l00079"></a>00079 <span class="keywordtype">void</span> rgb2uvw(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00080"></a>00080 <span class="keywordtype">void</span> uvw2rgb(t_cs *x, <span class="keywordtype">int</span> u, <span class="keywordtype">int</span> v, <span class="keywordtype">int</span> w);
<a name="l00081"></a>00081 <span class="keywordtype">void</span> rgb2cone(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00082"></a>00082 <span class="keywordtype">void</span> cone2rgb(t_cs *x, <span class="keywordtype">int</span> t1, <span class="keywordtype">int</span> t2, <span class="keywordtype">int</span> t3);
<a name="l00083"></a>00083 <span class="keywordtype">void</span> rgb2lab(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00084"></a>00084 <span class="keywordtype">void</span> lab2rgb(t_cs *x, <span class="keywordtype">int</span> l, <span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b);
<a name="l00085"></a>00085 <span class="keywordtype">void</span> rgb2yiq(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00086"></a>00086 <span class="keywordtype">void</span> yiq2rgb(t_cs *x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> q);
<a name="l00087"></a>00087 <span class="keywordtype">void</span> rgb2hls(t_cs *x, <span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue);
<a name="l00088"></a>00088 <span class="keywordtype">void</span> hls2rgb(t_cs *x, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> l, <span class="keywordtype">int</span> s);
<a name="l00089"></a>00089 <span class="keywordtype">void</span> rgb2rgbcie(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00090"></a>00090 <span class="keywordtype">void</span> rgbcie2rgb(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00091"></a>00091 <span class="keywordtype">void</span> rgb2rgbsmpte(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00092"></a>00092 <span class="keywordtype">void</span> rgbsmpte2rgb(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b);
<a name="l00093"></a>00093 <span class="keywordtype">void</span> rgb2hsl(t_cs *x, <span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue);
<a name="l00094"></a>00094 <span class="keywordtype">void</span> hsl2rgb(t_cs *x, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> s, <span class="keywordtype">int</span> l);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="keywordtype">double</span> hls_value(<span class="keywordtype">double</span> n1,<span class="keywordtype">double</span> n2,<span class="keywordtype">double</span> hue);
<a name="l00097"></a>00097 <span class="keywordtype">void</span> tristimulus_product(<span class="keywordtype">double</span> *matrix,<span class="keywordtype">double</span> *input,<span class="keywordtype">double</span> *output);
<a name="l00098"></a>00098 <span class="keywordtype">double</span> cbrt(<span class="keywordtype">double</span> x);
<a name="l00099"></a>00099         
<a name="l00100"></a>00100 <span class="comment">/*********************************************************/</span>
<a name="l00101"></a>00101 <span class="comment">//Main() Function</span>
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)                  <span class="comment">//main receives a copy of the Max function macros table </span>
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105         <span class="keywordtype">long</span> attrflags = 0;
<a name="l00106"></a>00106         t_class *c;
<a name="l00107"></a>00107         t_object *attr;
<a name="l00108"></a>00108         
<a name="l00109"></a>00109         jamoma_init();
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="comment">// Define our class</span>
<a name="l00112"></a>00112         c = class_new(<span class="stringliteral">"jcom.colorspace"</span>,(method)cs_new, (method)cs_free, (<span class="keywordtype">short</span>)<span class="keyword">sizeof</span>(t_cs), (method)0L, A_GIMME, 0);
<a name="l00113"></a>00113         class_obexoffset_set(c,calcoffset(t_cs, obex));
<a name="l00114"></a>00114         
<a name="l00115"></a>00115         <span class="comment">// Make methods available for our class:</span>
<a name="l00116"></a>00116         class_addmethod(c, (method)cs_bang,                                     <span class="stringliteral">"bang"</span>, 0L);    
<a name="l00117"></a>00117     class_addmethod(c, (method)cs_int,                                  <span class="stringliteral">"int"</span>, A_LONG, 0L);             <span class="comment">// Input as int</span>
<a name="l00118"></a>00118     class_addmethod(c, (method)cs_float,                                <span class="stringliteral">"float"</span>, A_FLOAT, 0L);  <span class="comment">// Input as float</span>
<a name="l00119"></a>00119     class_addmethod(c, (method)cs_list,                                 <span class="stringliteral">"list"</span>, A_GIMME, 0L);
<a name="l00120"></a>00120     class_addmethod(c, (method)cs_assist,                               <span class="stringliteral">"assist"</span>, A_CANT, 0L); 
<a name="l00121"></a>00121     class_addmethod(c, (method)object_obex_dumpout,     <span class="stringliteral">"dumpout"</span>, A_CANT,0);      
<a name="l00122"></a>00122     class_addmethod(c, (method)object_obex_quickref,    <span class="stringliteral">"quickref"</span>, A_CANT, 0);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="comment">// ATTRIBUTE: mode</span>
<a name="l00125"></a>00125         attr = attr_offset_new(<span class="stringliteral">"mode"</span>, _sym_symbol, attrflags,
<a name="l00126"></a>00126                 (method)0L,(method)0L, calcoffset(t_cs, attr_mode));
<a name="l00127"></a>00127         class_addattr(c, attr);
<a name="l00128"></a>00128         
<a name="l00129"></a>00129         <span class="comment">// ATTRIBUTE: outputtype</span>
<a name="l00130"></a>00130         attr = attr_offset_new(<span class="stringliteral">"outputtype"</span>, _sym_symbol, attrflags,
<a name="l00131"></a>00131                 (method)0L,(method)0L, calcoffset(t_cs, attr_outputtype));
<a name="l00132"></a>00132         class_addattr(c, attr);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <span class="comment">// ATTRIBUTE: autopack</span>
<a name="l00135"></a>00135         attr = attr_offset_new(<span class="stringliteral">"autopack"</span>, _sym_long, attrflags,
<a name="l00136"></a>00136                 (method)0L,(method)0L, calcoffset(t_cs, attr_autopack));
<a name="l00137"></a>00137         class_addattr(c, attr);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="comment">// initialize class globals</span>
<a name="l00140"></a>00140         ps_no_transform         = gensym(<span class="stringliteral">"no_transform"</span>);
<a name="l00141"></a>00141         ps_rgb2cmy                      = gensym(<span class="stringliteral">"rgb2cmy"</span>);
<a name="l00142"></a>00142         ps_cmy2rgb                      = gensym(<span class="stringliteral">"cmy2rgb"</span>);
<a name="l00143"></a>00143         ps_rgb2hsv                      = gensym(<span class="stringliteral">"rgb2hsv"</span>);
<a name="l00144"></a>00144         ps_hsv2rgb                      = gensym(<span class="stringliteral">"hsv2rgb"</span>);
<a name="l00145"></a>00145         ps_rgb2xyz                      = gensym(<span class="stringliteral">"rgb2xyz"</span>);
<a name="l00146"></a>00146         ps_xyz2rgb                      = gensym(<span class="stringliteral">"xyz2rgb"</span>);
<a name="l00147"></a>00147         ps_rgb2uvw                      = gensym(<span class="stringliteral">"rgb2uvw"</span>);
<a name="l00148"></a>00148         ps_uvw2rgb                      = gensym(<span class="stringliteral">"uvw2rgb"</span>);
<a name="l00149"></a>00149         ps_rgb2retinalcone      = gensym(<span class="stringliteral">"rgb2retinalcone"</span>);
<a name="l00150"></a>00150         ps_retinalcone2rgb      = gensym(<span class="stringliteral">"retinalcone2rgb"</span>);
<a name="l00151"></a>00151         ps_rgb2lab                      = gensym(<span class="stringliteral">"rgb2lab"</span>);
<a name="l00152"></a>00152         ps_lab2rgb                      = gensym(<span class="stringliteral">"lab2rgb"</span>);
<a name="l00153"></a>00153         ps_rgb2yiq                      = gensym(<span class="stringliteral">"rgb2yiq"</span>);
<a name="l00154"></a>00154         ps_yiq2rgb                      = gensym(<span class="stringliteral">"yiq2rgb"</span>);
<a name="l00155"></a>00155         ps_rgb2hls                      = gensym(<span class="stringliteral">"rgb2hls"</span>);
<a name="l00156"></a>00156         ps_hls2rgb                      = gensym(<span class="stringliteral">"hls2rgb"</span>);
<a name="l00157"></a>00157         ps_rgb2rgbcie           = gensym(<span class="stringliteral">"rgb2rgbcie"</span>);
<a name="l00158"></a>00158         ps_rgbcie2rgb           = gensym(<span class="stringliteral">"rgbcie2rgb"</span>);
<a name="l00159"></a>00159         ps_rgb2rgbsmpte         = gensym(<span class="stringliteral">"rgb2rgbsmpte"</span>);
<a name="l00160"></a>00160         ps_rgbsmpte2rgb         = gensym(<span class="stringliteral">"rgbsmpte2rgb"</span>);
<a name="l00161"></a>00161         ps_rgb2hsl                      = gensym(<span class="stringliteral">"rgb2hsl"</span>);
<a name="l00162"></a>00162         ps_hsl2rgb                      = gensym(<span class="stringliteral">"hsl2rgb"</span>);
<a name="l00163"></a>00163         
<a name="l00164"></a>00164         ps_split                        = gensym(<span class="stringliteral">"split"</span>);
<a name="l00165"></a>00165         ps_packed                       = gensym(<span class="stringliteral">"packed"</span>);
<a name="l00166"></a>00166         
<a name="l00167"></a>00167         <span class="comment">// Finalize our class</span>
<a name="l00168"></a>00168         class_register(CLASS_BOX, c);
<a name="l00169"></a>00169         this_class = c;
<a name="l00170"></a>00170         <span class="keywordflow">return</span> 0;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="comment">/*********************************************************/</span>
<a name="l00175"></a>00175 <span class="comment">//Object Creation Function</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="keywordtype">void</span> *cs_new(Symbol *msg, <span class="keywordtype">long</span> argc, Atom *argv)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179         t_cs    *x;                                                             <span class="comment">// Declare an object (based on our struct)</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         x = (t_cs *)object_alloc(this_class);           <span class="comment">// Create object, store pointer to it (get 1 inlet free)</span>
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (x) {
<a name="l00183"></a>00183                 object_obex_store((<span class="keywordtype">void</span> *)x, _sym_dumpout, (<span class="keywordtype">object</span> *)outlet_new(x,NULL));       <span class="comment">// dumpout</span>
<a name="l00184"></a>00184                 x-&gt;out3 = intout(x);
<a name="l00185"></a>00185                 x-&gt;out2 = intout(x);
<a name="l00186"></a>00186                 x-&gt;out1 = intout(x);                            <span class="comment">// Create the outlet</span>
<a name="l00187"></a>00187                 x-&gt;inlets[0] = proxy_new(x, 2, 0L);     <span class="comment">// Create inlet 3</span>
<a name="l00188"></a>00188                 x-&gt;inlets[1] = proxy_new(x, 1, 0L);     <span class="comment">// Create inlet 2</span>
<a name="l00189"></a>00189 
<a name="l00190"></a>00190                 <span class="comment">// Set defaults</span>
<a name="l00191"></a>00191                 x-&gt;attr_autopack = 1;
<a name="l00192"></a>00192                 x-&gt;attr_mode = ps_rgb2hsl;
<a name="l00193"></a>00193                 x-&gt;attr_outputtype = ps_split;
<a name="l00194"></a>00194                 x-&gt;val1 = x-&gt;val2 = x-&gt;val3 = 1;
<a name="l00195"></a>00195                 
<a name="l00196"></a>00196                 attr_args_process(x,argc,argv);         <span class="comment">//handle attribute args                 </span>
<a name="l00197"></a>00197         }       
<a name="l00198"></a>00198         <span class="keywordflow">return</span>(x);                                                              <span class="comment">// must return a pointer to the new instance </span>
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="keywordtype">void</span> cs_free(t_cs *x)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204         freeobject((t_object *)x-&gt;inlets[0]);
<a name="l00205"></a>00205         freeobject((t_object *)x-&gt;inlets[1]);
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="comment">/*********************************************************/</span>
<a name="l00210"></a>00210 <span class="comment">//Bound to inlet Functions</span>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">// Method for Assistance Messages</span>
<a name="l00213"></a>00213 <span class="keywordtype">void</span> cs_assist(t_cs *x, <span class="keywordtype">void</span> *b, <span class="keywordtype">long</span> msg, <span class="keywordtype">long</span> arg, <span class="keywordtype">char</span> *dst)
<a name="l00214"></a>00214 {
<a name="l00215"></a>00215         <span class="keywordflow">if</span>(msg==1){     <span class="comment">// Inlets</span>
<a name="l00216"></a>00216                 <span class="keywordflow">switch</span>(arg){
<a name="l00217"></a>00217                         <span class="keywordflow">case</span> 0: strcpy(dst, <span class="stringliteral">"mode $1/int/bang/list"</span>); <span class="keywordflow">break</span>;
<a name="l00218"></a>00218                         <span class="keywordflow">case</span> 1: strcpy(dst, <span class="stringliteral">"int"</span>); <span class="keywordflow">break</span>;
<a name="l00219"></a>00219                         <span class="keywordflow">case</span> 2: strcpy(dst, <span class="stringliteral">"int"</span>); <span class="keywordflow">break</span>;
<a name="l00220"></a>00220                 }
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(msg==2){ <span class="comment">// Outlets</span>
<a name="l00223"></a>00223                 <span class="keywordflow">switch</span>(arg){
<a name="l00224"></a>00224                         <span class="keywordflow">case</span> 0: strcpy(dst, <span class="stringliteral">"int or list"</span>); <span class="keywordflow">break</span>;
<a name="l00225"></a>00225                         <span class="keywordflow">case</span> 1: strcpy(dst, <span class="stringliteral">"int"</span>); <span class="keywordflow">break</span>;
<a name="l00226"></a>00226                         <span class="keywordflow">case</span> 2: strcpy(dst, <span class="stringliteral">"int"</span>); <span class="keywordflow">break</span>;
<a name="l00227"></a>00227                         <span class="keywordflow">case</span> 3: strcpy(dst, <span class="stringliteral">"dumpout"</span>); <span class="keywordflow">break</span>;
<a name="l00228"></a>00228                 }       
<a name="l00229"></a>00229         }       
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">// INTEGER INPUT</span>
<a name="l00234"></a>00234 <span class="keywordtype">void</span> cs_int(t_cs *x, <span class="keywordtype">long</span> value)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236         <span class="keywordtype">long</span> inletnum = proxy_getinlet((<span class="keywordtype">object</span> *)x);
<a name="l00237"></a>00237         <span class="keywordflow">switch</span>(inletnum){
<a name="l00238"></a>00238                 <span class="keywordflow">case</span> 0: x-&gt;val1 = value; <span class="keywordflow">break</span>;
<a name="l00239"></a>00239                 <span class="keywordflow">case</span> 1: x-&gt;val2 = value; <span class="keywordflow">break</span>;
<a name="l00240"></a>00240                 <span class="keywordflow">case</span> 2: x-&gt;val3 = value; <span class="keywordflow">break</span>;
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242         <span class="keywordflow">if</span>(x-&gt;attr_autopack)
<a name="l00243"></a>00243                 cs_bang(x);     
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="comment">// FLOAT INPUT</span>
<a name="l00248"></a>00248 <span class="keywordtype">void</span> cs_float(t_cs *x, <span class="keywordtype">double</span> value)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250         <span class="keywordtype">long</span> inletnum = proxy_getinlet((<span class="keywordtype">object</span> *)x);
<a name="l00251"></a>00251         
<a name="l00252"></a>00252         <span class="keywordflow">switch</span>(inletnum){
<a name="l00253"></a>00253                 <span class="keywordflow">case</span> 0: x-&gt;val1 = (int)value; <span class="keywordflow">break</span>;
<a name="l00254"></a>00254                 <span class="keywordflow">case</span> 1: x-&gt;val2 = (int)value; <span class="keywordflow">break</span>;
<a name="l00255"></a>00255                 <span class="keywordflow">case</span> 2: x-&gt;val3 = (int)value; <span class="keywordflow">break</span>;
<a name="l00256"></a>00256         }
<a name="l00257"></a>00257         <span class="keywordflow">if</span>(x-&gt;attr_autopack)
<a name="l00258"></a>00258                 cs_bang(x);     
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 <span class="comment">// LIST INPUT</span>
<a name="l00263"></a>00263 <span class="keywordtype">void</span> cs_list(t_cs *x, Symbol *msg, <span class="keywordtype">long</span> argc, Atom *argv)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         x-&gt;val1 = argv-&gt;a_w.w_long; argv++;
<a name="l00267"></a>00267         x-&gt;val2 = argv-&gt;a_w.w_long; argv++;
<a name="l00268"></a>00268         x-&gt;val3 = argv-&gt;a_w.w_long; argv++;
<a name="l00269"></a>00269         <span class="keywordflow">if</span>(x-&gt;attr_autopack)
<a name="l00270"></a>00270                 cs_bang(x);     
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 <span class="comment">// BANG - calculate and output</span>
<a name="l00275"></a>00275 <span class="keywordtype">void</span> cs_bang(t_cs *x)
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277         <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2hsl) rgb2hsl(x, x-&gt;val1, x-&gt;val2, x-&gt;val3); <span class="comment">// first for speed</span>
<a name="l00278"></a>00278         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_hsl2rgb) hsl2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00279"></a>00279         
<a name="l00280"></a>00280         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_no_transform) no_transform(x);
<a name="l00281"></a>00281         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2cmy) rgb2cmy(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00282"></a>00282         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_cmy2rgb) cmy2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00283"></a>00283         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2hsv) rgb2hsv(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00284"></a>00284         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_hsv2rgb) hsv2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00285"></a>00285         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2xyz) rgb2xyz(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00286"></a>00286         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_xyz2rgb) xyz2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00287"></a>00287         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2uvw) rgb2uvw(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00288"></a>00288         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_uvw2rgb) uvw2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00289"></a>00289         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2retinalcone) rgb2cone(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00290"></a>00290         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_retinalcone2rgb) cone2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00291"></a>00291         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2lab) rgb2lab(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00292"></a>00292         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_lab2rgb) lab2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00293"></a>00293         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2yiq) rgb2yiq(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00294"></a>00294         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_yiq2rgb) yiq2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00295"></a>00295         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2hls) rgb2hls(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00296"></a>00296         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_hls2rgb) hls2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00297"></a>00297         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2rgbcie) rgb2rgbcie(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00298"></a>00298         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgbcie2rgb) rgbcie2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00299"></a>00299         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgb2rgbsmpte) rgb2rgbsmpte(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00300"></a>00300         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(x-&gt;attr_mode == ps_rgbsmpte2rgb) rgbsmpte2rgb(x, x-&gt;val1, x-&gt;val2, x-&gt;val3);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <span class="keywordflow">if</span>(x-&gt;attr_outputtype == ps_packed){
<a name="l00303"></a>00303                 Atom temp_list[3];
<a name="l00304"></a>00304                 SETLONG(temp_list+0, x-&gt;calc1);
<a name="l00305"></a>00305                 SETLONG(temp_list+1, x-&gt;calc2);
<a name="l00306"></a>00306                 SETLONG(temp_list+2, x-&gt;calc3);
<a name="l00307"></a>00307                 outlet_list(x-&gt;out1, 0L, 3, temp_list); <span class="comment">// output the result</span>
<a name="l00308"></a>00308         }       
<a name="l00309"></a>00309         <span class="keywordflow">else</span>{
<a name="l00310"></a>00310                 outlet_int(x-&gt;out3, x-&gt;calc3);  <span class="comment">// output the result    </span>
<a name="l00311"></a>00311                 outlet_int(x-&gt;out2, x-&gt;calc2);  <span class="comment">// output the result    </span>
<a name="l00312"></a>00312                 outlet_int(x-&gt;out1, x-&gt;calc1);  <span class="comment">// output the result</span>
<a name="l00313"></a>00313         }       
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="comment">/*********************************************************/</span>
<a name="l00318"></a>00318 <span class="comment">// Conversion Functions</span>
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="keywordtype">void</span> no_transform(t_cs *x)
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322         x-&gt;calc1 = x-&gt;val1;
<a name="l00323"></a>00323         x-&gt;calc2 = x-&gt;val2;
<a name="l00324"></a>00324         x-&gt;calc3 = x-&gt;val3;
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="keywordtype">void</span> rgb2cmy (t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00328"></a>00328 {
<a name="l00329"></a>00329         x-&gt;calc1 = 255 - r;
<a name="l00330"></a>00330         x-&gt;calc2 = 255 - g;
<a name="l00331"></a>00331         x-&gt;calc3 = 255 - b;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="keywordtype">void</span> cmy2rgb(t_cs *x, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> y)
<a name="l00335"></a>00335 {
<a name="l00336"></a>00336         x-&gt;calc1 = 255 - c;
<a name="l00337"></a>00337         x-&gt;calc2 = 255 - m;
<a name="l00338"></a>00338         x-&gt;calc3 = 255 - y;
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 <span class="keywordtype">void</span> rgb2hsv(t_cs *x, <span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343     <span class="keywordtype">long</span>           <span class="comment">/*i, j, roubitez, pix, red, green, blue,*/</span> hue, saturation, value;
<a name="l00344"></a>00344     <span class="keywordtype">double</span>                      y,h,s,v, r,g,b, r1,g1,b1;                             
<a name="l00345"></a>00345 
<a name="l00346"></a>00346                                 <span class="comment">/* first thing, convert them to 0-1*/</span>
<a name="l00347"></a>00347                                 r = red/255.0;
<a name="l00348"></a>00348                                 g = green/255.0;
<a name="l00349"></a>00349                                 b = blue/255.0;
<a name="l00350"></a>00350                                 v = r;
<a name="l00351"></a>00351                                 <span class="keywordflow">if</span> (v&lt;g) v=g;
<a name="l00352"></a>00352                                 <span class="keywordflow">if</span> (v&lt;b) v=b;
<a name="l00353"></a>00353                                 y = r;
<a name="l00354"></a>00354                                 <span class="keywordflow">if</span> (y&gt;g) y=g;
<a name="l00355"></a>00355                                 <span class="keywordflow">if</span> (y&gt;b) y=b;
<a name="l00356"></a>00356                                 <span class="keywordflow">if</span> (v != 0) s = (v-y)/v;
<a name="l00357"></a>00357                                 <span class="keywordflow">else</span> { s = 0; }
<a name="l00358"></a>00358                                 <span class="keywordflow">if</span> (s == 0) {
<a name="l00359"></a>00359                                         hue = 0;
<a name="l00360"></a>00360                                         saturation = 0;
<a name="l00361"></a>00361                                         value = (int)(v*100);
<a name="l00362"></a>00362                                         <span class="keywordflow">goto</span> setit;
<a name="l00363"></a>00363                                 }                               
<a name="l00364"></a>00364                                 r1 = (v-r)/(v-y);
<a name="l00365"></a>00365                                 g1 = (v-g)/(v-y);
<a name="l00366"></a>00366                                 b1 = (v-b)/(v-y);
<a name="l00367"></a>00367                                   <span class="keywordflow">if</span> (r == v){
<a name="l00368"></a>00368                                     <span class="keywordflow">if</span> (g == y) h = 5.+b1;
<a name="l00369"></a>00369                                     <span class="keywordflow">else</span> h = 1.-g1;
<a name="l00370"></a>00370                                     }
<a name="l00371"></a>00371                                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (g == v){
<a name="l00372"></a>00372                                     <span class="keywordflow">if</span> (b == y) h = r1+1.;
<a name="l00373"></a>00373                                     <span class="keywordflow">else</span> h = 3.-b1;
<a name="l00374"></a>00374                                     }
<a name="l00375"></a>00375                                   <span class="keywordflow">else</span>{
<a name="l00376"></a>00376                                     <span class="keywordflow">if</span> (r == y) h = 3.+g1;
<a name="l00377"></a>00377                                     <span class="keywordflow">else</span> h = 5.-r1;
<a name="l00378"></a>00378                                     }
<a name="l00379"></a>00379                                 <span class="comment">// convert it all</span>
<a name="l00380"></a>00380                                 h = h * 60.; 
<a name="l00381"></a>00381                                 <span class="keywordflow">if</span> (h &gt;= 360.) h = h-360.;
<a name="l00382"></a>00382                                 hue = (int)h;   <span class="comment">//hue = (int)((h/360.)*255.0);</span>
<a name="l00383"></a>00383                                 saturation = (int)(s*100.); <span class="comment">/* was 0-1 from the start */</span>
<a name="l00384"></a>00384                                 value = (int)(v*100.); <span class="comment">/* it was 0-1 from the start */</span>
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 setit:
<a name="l00387"></a>00387         x-&gt;calc1 = hue;
<a name="l00388"></a>00388         x-&gt;calc2 = saturation;
<a name="l00389"></a>00389         x-&gt;calc3 = value;
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="comment">// HSV-2-RGB</span>
<a name="l00393"></a>00393 <span class="keywordtype">void</span> hsv2rgb(t_cs *x, <span class="keywordtype">int</span> hue, <span class="keywordtype">int</span> saturation, <span class="keywordtype">int</span> value)
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395         <span class="keywordtype">long</span>    red, green, blue;
<a name="l00396"></a>00396         <span class="keywordtype">double</span>  h,s,v,h1, a[7], tr, tg, tb, q, f;                             
<a name="l00397"></a>00397 
<a name="l00398"></a>00398         h = (float)hue;
<a name="l00399"></a>00399         s = saturation/100.0;
<a name="l00400"></a>00400         v = value/100.0;
<a name="l00401"></a>00401         h1 = h;
<a name="l00402"></a>00402         <span class="comment">//q = trunc(h1);</span>
<a name="l00403"></a>00403 <span class="preprocessor">#ifdef MAC_VERSION</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span>        q = roundf(h1);
<a name="l00405"></a>00405 <span class="preprocessor">#else</span>
<a name="l00406"></a>00406 <span class="preprocessor"></span>        q = (long)(h1 + 0.5);
<a name="l00407"></a>00407 <span class="preprocessor">#endif</span>
<a name="l00408"></a>00408 <span class="preprocessor"></span>        <span class="comment">//q = h1 + 0.49; // round</span>
<a name="l00409"></a>00409         f = h1-q; 
<a name="l00410"></a>00410         a[1] = v;
<a name="l00411"></a>00411         a[2] = v;
<a name="l00412"></a>00412         a[3] = v*(1-(s*f));
<a name="l00413"></a>00413         a[4] = v*(1-s);
<a name="l00414"></a>00414         a[5] = a[4];
<a name="l00415"></a>00415         a[6] = v*(1-(s*(1-f)));
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <span class="keywordflow">if</span> (q &gt; 4) q = q-4;
<a name="l00418"></a>00418         <span class="keywordflow">else</span> q = q+2;
<a name="l00419"></a>00419         tr=a[(int)q];
<a name="l00420"></a>00420 
<a name="l00421"></a>00421         <span class="keywordflow">if</span> (q &gt; 4) q = q-4;
<a name="l00422"></a>00422         <span class="keywordflow">else</span> q = q+2;
<a name="l00423"></a>00423         tb=a[(int)q];
<a name="l00424"></a>00424 
<a name="l00425"></a>00425         <span class="keywordflow">if</span> (q &gt; 4) q = q-4;
<a name="l00426"></a>00426         <span class="keywordflow">else</span> q = q+2;
<a name="l00427"></a>00427         tg=a[(int)q];
<a name="l00428"></a>00428                                 
<a name="l00429"></a>00429         <span class="comment">// output scaling</span>
<a name="l00430"></a>00430         x-&gt;calc1 = red = (int)(tr*255.);
<a name="l00431"></a>00431         x-&gt;calc2 = green = (int)(tg*255.);
<a name="l00432"></a>00432         x-&gt;calc3 = blue = (int)(tb*255.);
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="comment">// RGB-2-XYZ</span>
<a name="l00437"></a>00437 <span class="keywordtype">void</span> rgb2xyz(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439         <span class="keywordtype">long</span>            xc, yc, zc;
<a name="l00440"></a>00440         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00441"></a>00441         <span class="keywordtype">double</span> RnGnBn_XYZ[9]    = <span class="comment">/* from Jain 71, almost same as Pratt, 66 */</span>
<a name="l00442"></a>00442                                 { 0.60700,  0.17400,  0.20100,   
<a name="l00443"></a>00443                                   0.29900,  0.58700,  0.11400,  
<a name="l00444"></a>00444                                   0.00000,  0.06600,  1.11700 }; 
<a name="l00445"></a>00445                                   
<a name="l00446"></a>00446         input[0] = r;
<a name="l00447"></a>00447         input[1] = g;
<a name="l00448"></a>00448         input[2] = b;
<a name="l00449"></a>00449         tristimulus_product(RnGnBn_XYZ,input,output);                           
<a name="l00450"></a>00450         x-&gt;calc1 = xc=output[0]; 
<a name="l00451"></a>00451         x-&gt;calc2 = yc=output[1]; 
<a name="l00452"></a>00452         x-&gt;calc3 = zc=output[2]; 
<a name="l00453"></a>00453 }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 <span class="comment">// XYZ-2-RGB</span>
<a name="l00457"></a>00457 <span class="keywordtype">void</span> xyz2rgb(t_cs *x, <span class="keywordtype">int</span> xx, <span class="keywordtype">int</span> xy, <span class="keywordtype">int</span> xz)
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459         <span class="keywordtype">long</span>            xc, yc, zc;
<a name="l00460"></a>00460         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00461"></a>00461         <span class="keywordtype">double</span> XYZ_RnGnBn[9]    = <span class="comment">/* inverted from the above, almost same as Pratt, 67 */</span>
<a name="l00462"></a>00462                                 { 1.91036, -0.53375, -0.28929,   
<a name="l00463"></a>00463                                  -0.98438,  1.99838, -0.02682, 
<a name="l00464"></a>00464                                   0.05816, -0.11808,  0.89684 }; 
<a name="l00465"></a>00465                                   
<a name="l00466"></a>00466         input[0] = xx;
<a name="l00467"></a>00467         input[1] = xy;
<a name="l00468"></a>00468         input[2] = xz;
<a name="l00469"></a>00469         tristimulus_product(XYZ_RnGnBn,input,output);
<a name="l00470"></a>00470         x-&gt;calc1 = xc=output[0]; 
<a name="l00471"></a>00471         x-&gt;calc2 = yc=output[1]; 
<a name="l00472"></a>00472         x-&gt;calc3 = zc=output[2]; 
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="comment">// RGB-2-UVW</span>
<a name="l00477"></a>00477 <span class="keywordtype">void</span> rgb2uvw(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00478"></a>00478 {
<a name="l00479"></a>00479         <span class="keywordtype">long</span>    uc, vc, wc;
<a name="l00480"></a>00480         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00481"></a>00481         <span class="keywordtype">double</span> RnGnBn_UVW[9]    =  <span class="comment">/* matches both Jain, 71 and Pratt, 66 */</span>
<a name="l00482"></a>00482                                 { 0.40500,  0.11600,  0.13300,  
<a name="l00483"></a>00483                                   0.29900,  0.58700,  0.11400,
<a name="l00484"></a>00484                                   0.14500,  0.82700,  0.62700 };
<a name="l00485"></a>00485             
<a name="l00486"></a>00486         input[0] = r;
<a name="l00487"></a>00487         input[1] = g;
<a name="l00488"></a>00488         input[2] = b;
<a name="l00489"></a>00489         tristimulus_product(RnGnBn_UVW,input,output);
<a name="l00490"></a>00490         x-&gt;calc1 = uc=output[0]; 
<a name="l00491"></a>00491         x-&gt;calc2 = vc=output[1]; 
<a name="l00492"></a>00492         x-&gt;calc3 = wc=output[2]; 
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 
<a name="l00496"></a>00496 <span class="comment">// UVW-2-RGB</span>
<a name="l00497"></a>00497 <span class="keywordtype">void</span> uvw2rgb(t_cs *x, <span class="keywordtype">int</span> u, <span class="keywordtype">int</span> v, <span class="keywordtype">int</span> w)
<a name="l00498"></a>00498 {
<a name="l00499"></a>00499         <span class="keywordtype">long</span>    red, green, blue;
<a name="l00500"></a>00500         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00501"></a>00501         <span class="keywordtype">double</span> UVW_RnGnBn[9]    =  <span class="comment">/* inverted from above, almost same as Pratt, 67 */</span>
<a name="l00502"></a>00502                                 { 2.43104,  0.33085, -0.57583, 
<a name="l00503"></a>00503                                   -1.51794,  2.08365, -0.05686, 
<a name="l00504"></a>00504                                   1.43993, -2.82480,  1.80306 };  
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         input[0] = u;
<a name="l00507"></a>00507         input[1] = v;
<a name="l00508"></a>00508         input[2] = w;
<a name="l00509"></a>00509         tristimulus_product(UVW_RnGnBn,input,output);
<a name="l00510"></a>00510         x-&gt;calc1 = red=output[0]; 
<a name="l00511"></a>00511         x-&gt;calc2 = green=output[1]; 
<a name="l00512"></a>00512         x-&gt;calc3 = blue=output[2]; 
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="comment">// RGB-2-RETINAL CONE</span>
<a name="l00517"></a>00517 <span class="keywordtype">void</span> rgb2cone(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519         <span class="keywordtype">long</span>    t1, t2, t3;
<a name="l00520"></a>00520         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00521"></a>00521         <span class="keywordtype">double</span> RnGnBn_XYZ[9]    = <span class="comment">/* from Jain 71, almost same as Pratt, 66 */</span>
<a name="l00522"></a>00522                                 { 0.60700,  0.17400,  0.20100,   
<a name="l00523"></a>00523                                   0.29900,  0.58700,  0.11400,  
<a name="l00524"></a>00524                                   0.00000,  0.06600,  1.11700 }; 
<a name="l00525"></a>00525         <span class="keywordtype">double</span> XYZ_RetinalCone[9] = <span class="comment">/* from Pratt, 73 */</span>
<a name="l00526"></a>00526                                 { 0.00000,  1.00000,  0.00000,
<a name="l00527"></a>00527                                  -0.46000,  1.35900,  0.10100,
<a name="l00528"></a>00528                                   0.00000,  0.00000,  1.00000 };
<a name="l00529"></a>00529 
<a name="l00530"></a>00530         input[0] = r/255.;
<a name="l00531"></a>00531         input[1] = g/255.;
<a name="l00532"></a>00532         input[2] = b/255.;
<a name="l00533"></a>00533         tristimulus_product(RnGnBn_XYZ,input,output);
<a name="l00534"></a>00534         tristimulus_product(XYZ_RetinalCone,output,input);
<a name="l00535"></a>00535         x-&gt;calc1 = t1=(int)(output[0]*255.); 
<a name="l00536"></a>00536         x-&gt;calc2 = t2=(int)(output[1]*255.); 
<a name="l00537"></a>00537         x-&gt;calc3 = t3=(int)(output[2]*255.); 
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 <span class="comment">// RETINAL CONE-2-RGB</span>
<a name="l00542"></a>00542 <span class="keywordtype">void</span> cone2rgb(t_cs *x, <span class="keywordtype">int</span> t1, <span class="keywordtype">int</span> t2, <span class="keywordtype">int</span> t3)
<a name="l00543"></a>00543 {
<a name="l00544"></a>00544         <span class="keywordtype">long</span>    red, green, blue;
<a name="l00545"></a>00545         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00546"></a>00546         <span class="keywordtype">double</span> XYZ_RnGnBn[9]    = <span class="comment">/* inverted from the above, almost same as Pratt, 67 */</span>
<a name="l00547"></a>00547                                 { 1.91036, -0.53375, -0.28929,   
<a name="l00548"></a>00548                                  -0.98438,  1.99838, -0.02682, 
<a name="l00549"></a>00549                                   0.05816, -0.11808,  0.89684 }; 
<a name="l00550"></a>00550         <span class="keywordtype">double</span> RetinalCone_XYZ[9] = <span class="comment">/* inverted from above */</span>
<a name="l00551"></a>00551                                 { 2.95435, -2.17391,  0.21957,
<a name="l00552"></a>00552                                 1.00000,  0.00000,  0.00000,    
<a name="l00553"></a>00553                                 0.00000,  0.00000,  1.00000 };
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         input[0] = t1/255.;
<a name="l00556"></a>00556         input[1] = t2/255.;
<a name="l00557"></a>00557         input[2] = t3/255.;
<a name="l00558"></a>00558         tristimulus_product(RetinalCone_XYZ,input,output);
<a name="l00559"></a>00559         tristimulus_product(XYZ_RnGnBn,output,input);
<a name="l00560"></a>00560         x-&gt;calc1 = red=(int)(output[0]*255.); 
<a name="l00561"></a>00561         x-&gt;calc2 = green=(int)(output[1]*255.); 
<a name="l00562"></a>00562         x-&gt;calc3 = blue=(int)(output[2]*255.); 
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 <span class="comment">// RGB-2-L*A*B</span>
<a name="l00567"></a>00567 <span class="keywordtype">void</span> rgb2lab(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569         <span class="keywordtype">long</span>    ls, as, bs;
<a name="l00570"></a>00570         <span class="keywordtype">double</span> X0 = 0.982, Y0 = 1.000, Z0 = 1.183;
<a name="l00571"></a>00571         <span class="keywordtype">double</span> X,Y,Z,Ls,As,Bs,Xn,Yn,Zn,X3,Y3,Z3;
<a name="l00572"></a>00572         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00573"></a>00573         <span class="keywordtype">double</span> RnGnBn_XYZ[9]    =
<a name="l00574"></a>00574                                 { 0.60700,  0.17400,  0.20100,   
<a name="l00575"></a>00575                                   0.29900,  0.58700,  0.11400,  
<a name="l00576"></a>00576                                   0.00000,  0.06600,  1.11700 }; 
<a name="l00577"></a>00577             
<a name="l00578"></a>00578         input[0] = r/255.;
<a name="l00579"></a>00579         input[1] = r/255.;
<a name="l00580"></a>00580         input[2] = r/255.;
<a name="l00581"></a>00581         tristimulus_product(RnGnBn_XYZ,input,output);
<a name="l00582"></a>00582         X=output[0]; 
<a name="l00583"></a>00583         Y=output[1]; 
<a name="l00584"></a>00584         Z=output[2]; 
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         Yn = 100*Y/Y0;
<a name="l00587"></a>00587         Ls = 25*cbrt(Yn)-16.;
<a name="l00588"></a>00588         Xn = X/X0;  
<a name="l00589"></a>00589         Yn = Y/Y0;  
<a name="l00590"></a>00590         Zn = Z/Z0;  
<a name="l00591"></a>00591         X3 = cbrt(Xn);
<a name="l00592"></a>00592         Y3 = cbrt(Yn);
<a name="l00593"></a>00593         Z3 = cbrt(Zn);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595         As = 500*(X3-Y3);
<a name="l00596"></a>00596         Bs = 200*(Y3-Z3);
<a name="l00597"></a>00597                                 
<a name="l00598"></a>00598         x-&gt;calc1 = ls = (int)(((Ls+16.)/116.04)*255.);  
<a name="l00599"></a>00599         x-&gt;calc2 = as = (int)(((As+137.82)/234.)*255.);  
<a name="l00600"></a>00600         x-&gt;calc3 = bs = (int)(((Bs+99.23)/232.97)*255.);
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <span class="comment">// L*A*B-2-RGB</span>
<a name="l00605"></a>00605 <span class="keywordtype">void</span> lab2rgb(t_cs *x, <span class="keywordtype">int</span> ls, <span class="keywordtype">int</span> as, <span class="keywordtype">int</span> bs)
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607         <span class="keywordtype">long</span>    red, green, blue;
<a name="l00608"></a>00608         <span class="keywordtype">double</span> ltemp,xtemp,ytemp,ztemp, l, a, b;
<a name="l00609"></a>00609         <span class="keywordtype">double</span> X0 = 0.982, Y0 = 1.000, Z0 = 1.183;
<a name="l00610"></a>00610         <span class="keywordtype">double</span> X,Y,Z;
<a name="l00611"></a>00611         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00612"></a>00612         <span class="keywordtype">double</span> XYZ_RnGnBn[9]    = <span class="comment">/* inverted from the above, almost same as Pratt, 67 */</span>
<a name="l00613"></a>00613                                 { 1.91036, -0.53375, -0.28929,   
<a name="l00614"></a>00614                                  -0.98438,  1.99838, -0.02682, 
<a name="l00615"></a>00615                                   0.05816, -0.11808,  0.89684 }; 
<a name="l00616"></a>00616             
<a name="l00617"></a>00617         l = (((ls/255.)*116.04)-16.);
<a name="l00618"></a>00618         a = (((as/255.)*234.)-137.82);
<a name="l00619"></a>00619         b = (((bs/255.)*232.97)-99.23);
<a name="l00620"></a>00620         ltemp = (l+16.)/25.;
<a name="l00621"></a>00621         xtemp = X0*pow((a/500.+cbrt(0.01)*ltemp),3.);
<a name="l00622"></a>00622         ytemp = Y0*pow(ltemp,3.)/100.; <span class="comment">/* ha-haa, Pratt forgot this /100. */</span>
<a name="l00623"></a>00623         ztemp = Z0*pow(cbrt(0.01)*ltemp-(b/200.),3.);
<a name="l00624"></a>00624 
<a name="l00625"></a>00625         input[0] = X = xtemp;
<a name="l00626"></a>00626         input[1] = Y = ytemp;
<a name="l00627"></a>00627         input[2] = Z = ztemp;
<a name="l00628"></a>00628         tristimulus_product(XYZ_RnGnBn,input,output);
<a name="l00629"></a>00629         x-&gt;calc1 = red=output[0]*255.; 
<a name="l00630"></a>00630         x-&gt;calc2 = green=output[1]*255.; 
<a name="l00631"></a>00631         x-&gt;calc3 = blue=output[2]*255.; 
<a name="l00632"></a>00632 }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 <span class="comment">// RGB-2-YIQ</span>
<a name="l00636"></a>00636 <span class="keywordtype">void</span> rgb2yiq(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00637"></a>00637 {
<a name="l00638"></a>00638         <span class="keywordtype">long</span>    Y,I,Q;
<a name="l00639"></a>00639         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00640"></a>00640         <span class="keywordtype">double</span> RnGnBn_YIQ[9]    =  <span class="comment">/* matches Pratt 66 and Jain 71 */</span>
<a name="l00641"></a>00641                                 { 0.29900,  0.58700,  0.11400,   
<a name="l00642"></a>00642                                   0.59600, -0.27400, -0.32200,
<a name="l00643"></a>00643                                   0.21100, -0.52300,  0.31200 };
<a name="l00644"></a>00644             
<a name="l00645"></a>00645         input[0] = r;
<a name="l00646"></a>00646         input[1] = g;
<a name="l00647"></a>00647         input[2] = b;
<a name="l00648"></a>00648         tristimulus_product(RnGnBn_YIQ,input,output);
<a name="l00649"></a>00649         x-&gt;calc1 = Y=output[0]; 
<a name="l00650"></a>00650         x-&gt;calc2 = I=output[1]; 
<a name="l00651"></a>00651         x-&gt;calc3 = Q=output[2]; 
<a name="l00652"></a>00652 }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="comment">// YIQ-2-RGB</span>
<a name="l00656"></a>00656 <span class="keywordtype">void</span> yiq2rgb(t_cs *x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> q)
<a name="l00657"></a>00657 {
<a name="l00658"></a>00658         <span class="keywordtype">long</span>    red, green, blue;
<a name="l00659"></a>00659         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00660"></a>00660         <span class="keywordtype">double</span> YIQ_RnGnBn[9]    =  <span class="comment">/* inverted from above, almost same as Pratt, 67 */</span>
<a name="l00661"></a>00661                                 { 1.00000,  0.95617,  0.62143,   
<a name="l00662"></a>00662                                   1.00000, -0.27269, -0.64681, 
<a name="l00663"></a>00663                                   1.00000, -1.10374,  1.70062 } ; 
<a name="l00664"></a>00664            
<a name="l00665"></a>00665         input[0] = y;
<a name="l00666"></a>00666         input[1] = i;
<a name="l00667"></a>00667         input[2] = q;
<a name="l00668"></a>00668         tristimulus_product(YIQ_RnGnBn,input,output);
<a name="l00669"></a>00669         x-&gt;calc1 = red=output[0]; 
<a name="l00670"></a>00670         x-&gt;calc2 = green=output[1]; 
<a name="l00671"></a>00671         x-&gt;calc3 = blue=output[2]; 
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 <span class="comment">// RGB-2-HLS</span>
<a name="l00676"></a>00676 <span class="keywordtype">void</span> rgb2hls(t_cs *x, <span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue)
<a name="l00677"></a>00677 {
<a name="l00678"></a>00678         <span class="keywordtype">long</span>           <span class="comment">/*i, j, roubitez, pix, */</span>hue, lightness, saturation<span class="comment">/*, red, green, blue*/</span>;
<a name="l00679"></a>00679         <span class="keywordtype">double</span> max,min,delta;
<a name="l00680"></a>00680         <span class="keywordtype">double</span> r,g,b;
<a name="l00681"></a>00681         <span class="keywordtype">double</span> H,L,S;
<a name="l00682"></a>00682         
<a name="l00683"></a>00683         <span class="comment">/* first thing, convert them to 0-1*/</span>
<a name="l00684"></a>00684         r = red/255.0;
<a name="l00685"></a>00685         g = green/255.0;
<a name="l00686"></a>00686         b = blue/255.0;
<a name="l00687"></a>00687         max = r;
<a name="l00688"></a>00688         <span class="keywordflow">if</span> (max&lt;g) max=g;
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (max&lt;b) max=b;
<a name="l00690"></a>00690         min = r;
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (min&gt;g) min=g;
<a name="l00692"></a>00692         <span class="keywordflow">if</span> (min&gt;b) min=b;
<a name="l00693"></a>00693         L = (max+min)/2.0;
<a name="l00694"></a>00694         <span class="keywordflow">if</span> (max == min){
<a name="l00695"></a>00695                 S = 0;
<a name="l00696"></a>00696                 H = 0;
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698         <span class="keywordflow">else</span>{
<a name="l00699"></a>00699                 delta = max-min;
<a name="l00700"></a>00700                 <span class="keywordflow">if</span> (L &lt; 0.5) S = delta/(max+min);
<a name="l00701"></a>00701                 <span class="keywordflow">else</span> S = delta/(2.0-max-min);
<a name="l00702"></a>00702                 <span class="keywordflow">if</span> (r == max) H = (g-b)/delta;
<a name="l00703"></a>00703                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (g == max) H = 2.0+(b-r)/delta;
<a name="l00704"></a>00704                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b == max) H = 4.0+(r-g)/delta;
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706         H *= 60.; <span class="keywordflow">if</span> (H &lt; 0) H += 360.;   
<a name="l00707"></a>00707 <span class="comment">//      hue = (int)((H/360.)*255.0);</span>
<a name="l00708"></a>00708         hue = (int)H;
<a name="l00709"></a>00709         saturation = S*100.;
<a name="l00710"></a>00710         lightness = L*100.;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712         x-&gt;calc1 = hue;
<a name="l00713"></a>00713         x-&gt;calc2 = lightness;
<a name="l00714"></a>00714         x-&gt;calc3 = saturation;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="comment">// HLS-2-RGB</span>
<a name="l00719"></a>00719 <span class="keywordtype">void</span> hls2rgb(t_cs *x, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> l, <span class="keywordtype">int</span> s)
<a name="l00720"></a>00720 {
<a name="l00721"></a>00721         <span class="keywordtype">long</span>            red, green, blue;
<a name="l00722"></a>00722         <span class="keywordtype">double</span>  m1,m2,tr,tg,tb, hue, lightness, saturation;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724         <span class="comment">// scale to floating point... number range should be 360, 1, 1</span>
<a name="l00725"></a>00725         hue = (float)h;
<a name="l00726"></a>00726         <span class="comment">//hue = ((hue/255.)*360.);</span>
<a name="l00727"></a>00727         saturation = (float)s/100.0;
<a name="l00728"></a>00728         lightness = (float)l/100.0;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         <span class="keywordflow">if</span> (lightness &lt;= 0.5) m2 = lightness*(1.0+saturation); 
<a name="l00731"></a>00731         <span class="keywordflow">else</span> m2 = lightness+saturation-lightness*saturation;
<a name="l00732"></a>00732         m1 = 2.0*lightness-m2;
<a name="l00733"></a>00733         <span class="keywordflow">if</span> (saturation == 0.0){
<a name="l00734"></a>00734                 tr = lightness;
<a name="l00735"></a>00735                 tg = lightness;
<a name="l00736"></a>00736                 tb = lightness;
<a name="l00737"></a>00737         } 
<a name="l00738"></a>00738         <span class="keywordflow">else</span>{
<a name="l00739"></a>00739                 tr = hls_value(m1,m2,hue+120.);
<a name="l00740"></a>00740                 tg = hls_value(m1,m2,hue);
<a name="l00741"></a>00741                 tb = hls_value(m1,m2,hue-120.);
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743         red = (int)(tr*255.);
<a name="l00744"></a>00744         green = (int)(tg*255.);
<a name="l00745"></a>00745         blue = (int)(tb*255.);
<a name="l00746"></a>00746         
<a name="l00747"></a>00747         x-&gt;calc1 = red;
<a name="l00748"></a>00748         x-&gt;calc2 = green;
<a name="l00749"></a>00749         x-&gt;calc3 = blue;
<a name="l00750"></a>00750 }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752         
<a name="l00753"></a>00753 <span class="comment">// RGB-2-RGBCIE</span>
<a name="l00754"></a>00754 <span class="keywordtype">void</span> rgb2rgbcie(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00755"></a>00755 {
<a name="l00756"></a>00756         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00757"></a>00757         <span class="keywordtype">double</span> RnGnBn_RcGcBc[9] = <span class="comment">/* confirmed in Jain, 71 &amp; Pratt, 66 */</span> 
<a name="l00758"></a>00758                                 { 1.16675, -0.14580, -0.15136,  
<a name="l00759"></a>00759                                   0.11377,  0.75243,  0.15874, 
<a name="l00760"></a>00760                                  -0.00165,  0.05918,  1.12839 }; 
<a name="l00761"></a>00761 
<a name="l00762"></a>00762         input[0] = r;
<a name="l00763"></a>00763         input[1] = g;
<a name="l00764"></a>00764         input[2] = b;
<a name="l00765"></a>00765         tristimulus_product(RnGnBn_RcGcBc,input,output);
<a name="l00766"></a>00766         x-&gt;calc1 = r = output[0];
<a name="l00767"></a>00767         x-&gt;calc2 = g = output[1];
<a name="l00768"></a>00768         x-&gt;calc3 = b = output[2];
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="comment">// RGBCIE-2-RGB</span>
<a name="l00773"></a>00773 <span class="keywordtype">void</span> rgbcie2rgb(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00774"></a>00774 {
<a name="l00775"></a>00775         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00776"></a>00776         <span class="keywordtype">double</span> RnGnBn_RcGcBc[9] = <span class="comment">/* from inverse of RnGnB_RcGcBc, confirmed in Pratt, 66 */</span>
<a name="l00777"></a>00777                                 { 0.84200,  0.15600,  0.09100,  
<a name="l00778"></a>00778                                  -0.12900,  1.32000, -0.20300, 
<a name="l00779"></a>00779                                   0.00800, -0.06900,  0.89700 };
<a name="l00780"></a>00780 
<a name="l00781"></a>00781         input[0] = r;
<a name="l00782"></a>00782         input[1] = g;
<a name="l00783"></a>00783         input[2] = b;
<a name="l00784"></a>00784         tristimulus_product(RnGnBn_RcGcBc,input,output);
<a name="l00785"></a>00785         x-&gt;calc1 = r = output[0];
<a name="l00786"></a>00786         x-&gt;calc2 = g = output[1];
<a name="l00787"></a>00787         x-&gt;calc3 = b = output[2];
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 <span class="comment">// RGB-2-RGBSMPTE</span>
<a name="l00792"></a>00792 <span class="keywordtype">void</span> rgb2rgbsmpte(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00795"></a>00795         <span class="keywordtype">double</span> RnGnBn_RsGsBs[9] = <span class="comment">/* From Pratt, 66, unverified */</span> 
<a name="l00796"></a>00796                                 { 1.60900, -0.44700, -0.10400,  
<a name="l00797"></a>00797                                  -0.05800,  0.97700,  0.05100, 
<a name="l00798"></a>00798                                  -0.02500, -0.03700,  1.16200 }; 
<a name="l00799"></a>00799 
<a name="l00800"></a>00800         input[0] = r;
<a name="l00801"></a>00801         input[1] = g;
<a name="l00802"></a>00802         input[2] = b;
<a name="l00803"></a>00803         tristimulus_product(RnGnBn_RsGsBs,input,output);
<a name="l00804"></a>00804         x-&gt;calc1 = r = output[0];
<a name="l00805"></a>00805         x-&gt;calc2 = g = output[1];
<a name="l00806"></a>00806         x-&gt;calc3 = b = output[2];
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 <span class="comment">// RGBSMPTE-2-RGB</span>
<a name="l00811"></a>00811 <span class="keywordtype">void</span> rgbsmpte2rgb(t_cs *x, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> g, <span class="keywordtype">int</span> b)
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813         <span class="keywordtype">double</span> input[3],output[3];
<a name="l00814"></a>00814         <span class="keywordtype">double</span> RsGsBs_RnGnBn[9] = <span class="comment">/* Inverted from above, expect some rounding errors */</span> 
<a name="l00815"></a>00815                                 { 0.63268,  0.29113,  0.04385,
<a name="l00816"></a>00816                               0.03679,  1.03877, -0.04230,
<a name="l00817"></a>00817                               0.01478,  0.03934,  0.86018 };
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         input[0] = r;
<a name="l00820"></a>00820         input[1] = g;
<a name="l00821"></a>00821         input[2] = b;
<a name="l00822"></a>00822         tristimulus_product(RsGsBs_RnGnBn,input,output);
<a name="l00823"></a>00823         x-&gt;calc1 = r = output[0];
<a name="l00824"></a>00824         x-&gt;calc2 = g = output[1];
<a name="l00825"></a>00825         x-&gt;calc3 = b = output[2];
<a name="l00826"></a>00826 }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <span class="comment">// RGB-2-HSL</span>
<a name="l00830"></a>00830 <span class="keywordtype">void</span> rgb2hsl(t_cs *x, <span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue)
<a name="l00831"></a>00831 {
<a name="l00832"></a>00832         <span class="keywordtype">long</span>           <span class="comment">/*i, j, roubitez, pix, */</span>hue, lightness, saturation<span class="comment">/*, red, green, blue*/</span>;
<a name="l00833"></a>00833         <span class="keywordtype">double</span> max,min,delta;
<a name="l00834"></a>00834         <span class="keywordtype">double</span> r,g,b;
<a name="l00835"></a>00835         <span class="keywordtype">double</span> H,L,S;
<a name="l00836"></a>00836         
<a name="l00837"></a>00837         <span class="comment">/* first thing, convert them to 0-1*/</span>
<a name="l00838"></a>00838         r = red/255.0;
<a name="l00839"></a>00839         g = green/255.0;
<a name="l00840"></a>00840         b = blue/255.0;
<a name="l00841"></a>00841         max = r;
<a name="l00842"></a>00842         <span class="keywordflow">if</span> (max&lt;g) max=g;
<a name="l00843"></a>00843         <span class="keywordflow">if</span> (max&lt;b) max=b;
<a name="l00844"></a>00844         min = r;
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (min&gt;g) min=g;
<a name="l00846"></a>00846         <span class="keywordflow">if</span> (min&gt;b) min=b;
<a name="l00847"></a>00847         L = (max+min)/2.0;
<a name="l00848"></a>00848         <span class="keywordflow">if</span> (max == min){
<a name="l00849"></a>00849                 S = 0;
<a name="l00850"></a>00850                 H = 0;
<a name="l00851"></a>00851         }
<a name="l00852"></a>00852         <span class="keywordflow">else</span>{
<a name="l00853"></a>00853                 delta = max-min;
<a name="l00854"></a>00854                 <span class="keywordflow">if</span> (L &lt; 0.5) S = delta/(max+min);
<a name="l00855"></a>00855                 <span class="keywordflow">else</span> S = delta/(2.0-max-min);
<a name="l00856"></a>00856                 <span class="keywordflow">if</span> (r == max) H = (g-b)/delta;
<a name="l00857"></a>00857                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (g == max) H = 2.0+(b-r)/delta;
<a name="l00858"></a>00858                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b == max) H = 4.0+(r-g)/delta;
<a name="l00859"></a>00859         }
<a name="l00860"></a>00860         H *= 60.; <span class="keywordflow">if</span> (H &lt; 0) H += 360.;   
<a name="l00861"></a>00861 <span class="comment">//      hue = (int)((H/360.)*255.0);</span>
<a name="l00862"></a>00862         hue = (int)H;
<a name="l00863"></a>00863         saturation = S*100.;
<a name="l00864"></a>00864         lightness = L*100.;
<a name="l00865"></a>00865 
<a name="l00866"></a>00866         x-&gt;calc1 = hue;
<a name="l00867"></a>00867         x-&gt;calc2 = saturation;  
<a name="l00868"></a>00868         x-&gt;calc3 = lightness;
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 
<a name="l00872"></a>00872 <span class="comment">// HSL-2-RGB</span>
<a name="l00873"></a>00873 <span class="keywordtype">void</span> hsl2rgb(t_cs *x, <span class="keywordtype">int</span> h, <span class="keywordtype">int</span> s, <span class="keywordtype">int</span> l)
<a name="l00874"></a>00874 {
<a name="l00875"></a>00875         <span class="keywordtype">long</span>            red, green, blue;
<a name="l00876"></a>00876         <span class="keywordtype">double</span>  m1,m2,tr,tg,tb, hue, lightness, saturation;
<a name="l00877"></a>00877 
<a name="l00878"></a>00878         <span class="comment">// scale to floating point... number range should be 360, 1, 1</span>
<a name="l00879"></a>00879         hue = (float)h;
<a name="l00880"></a>00880         <span class="comment">//hue = ((hue/255.)*360.);</span>
<a name="l00881"></a>00881         saturation = (float)s/100.0;
<a name="l00882"></a>00882         lightness = (float)l/100.0;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884         <span class="keywordflow">if</span> (lightness &lt;= 0.5) m2 = lightness*(1.0+saturation); 
<a name="l00885"></a>00885         <span class="keywordflow">else</span> m2 = lightness+saturation-lightness*saturation;
<a name="l00886"></a>00886         m1 = 2.0*lightness-m2;
<a name="l00887"></a>00887         <span class="keywordflow">if</span> (saturation == 0.0){
<a name="l00888"></a>00888                 tr = lightness;
<a name="l00889"></a>00889                 tg = lightness;
<a name="l00890"></a>00890                 tb = lightness;
<a name="l00891"></a>00891         } 
<a name="l00892"></a>00892         <span class="keywordflow">else</span>{
<a name="l00893"></a>00893                 tr = hls_value(m1,m2,hue+120.);
<a name="l00894"></a>00894                 tg = hls_value(m1,m2,hue);
<a name="l00895"></a>00895                 tb = hls_value(m1,m2,hue-120.);
<a name="l00896"></a>00896         }
<a name="l00897"></a>00897         red = (int)(tr*255.);
<a name="l00898"></a>00898         green = (int)(tg*255.);
<a name="l00899"></a>00899         blue = (int)(tb*255.);
<a name="l00900"></a>00900         
<a name="l00901"></a>00901         x-&gt;calc1 = red;
<a name="l00902"></a>00902         x-&gt;calc2 = green;
<a name="l00903"></a>00903         x-&gt;calc3 = blue;
<a name="l00904"></a>00904 }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906 
<a name="l00907"></a>00907 <span class="comment">/*********************************************************/</span>
<a name="l00908"></a>00908 <span class="comment">// Additional Functions</span>
<a name="l00909"></a>00909 
<a name="l00910"></a>00910 <span class="keywordtype">double</span> hls_value(<span class="keywordtype">double</span> n1,<span class="keywordtype">double</span> n2,<span class="keywordtype">double</span> hue)
<a name="l00911"></a>00911 {
<a name="l00912"></a>00912         <span class="keywordflow">if</span> (hue &gt; 360.0) hue -= 360.;
<a name="l00913"></a>00913         <span class="keywordflow">if</span> (hue &lt; 0.0) hue += 360.;
<a name="l00914"></a>00914         <span class="keywordflow">if</span> (hue &lt; 60.) <span class="keywordflow">return</span> (n1+(n2-n1)*hue/60.);
<a name="l00915"></a>00915         <span class="keywordflow">if</span> (hue &lt; 180.) <span class="keywordflow">return</span> n2;
<a name="l00916"></a>00916         <span class="keywordflow">if</span> (hue &lt; 240.) <span class="keywordflow">return</span> (n1+(n2-n1)*(240-hue)/60.);
<a name="l00917"></a>00917         <span class="keywordflow">return</span> n1;
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 <span class="comment">// tristimulus product used for matrix conversions</span>
<a name="l00922"></a>00922 <span class="keywordtype">void</span> tristimulus_product(<span class="keywordtype">double</span> *matrix,<span class="keywordtype">double</span> *input,<span class="keywordtype">double</span> *output)
<a name="l00923"></a>00923 {
<a name="l00924"></a>00924         <span class="keywordtype">int</span> f;
<a name="l00925"></a>00925         <span class="keywordflow">for</span>(f=0;f&lt;3;f++)
<a name="l00926"></a>00926                 output[f] = input[0]*matrix[f*3+0]+input[1]*matrix[f*3+1]+input[2]*matrix[f*3+2];
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 
<a name="l00930"></a>00930 <span class="comment">// CBRT</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932 <span class="comment">//double cbrt(x)</span>
<a name="l00933"></a>00933 <span class="comment">//double x;</span>
<a name="l00934"></a>00934 <span class="keywordtype">double</span> cbrt(<span class="keywordtype">double</span> x)
<a name="l00935"></a>00935 {
<a name="l00936"></a>00936         <span class="keywordtype">int</span> e, rem, sign;
<a name="l00937"></a>00937         <span class="keywordtype">double</span> z;
<a name="l00938"></a>00938         <span class="comment">//double frexp(), ldexp();</span>
<a name="l00939"></a>00939         <span class="keywordtype">short</span> CBT2[] = {0x3ff4,0x28a2,0xf98d,0x728b};
<a name="l00940"></a>00940         <span class="keywordtype">short</span> CBT4[] = {0x3ff9,0x65fe,0xa53d,0x6e3d};
<a name="l00941"></a>00941         <span class="keywordtype">double</span> CBRT2 = *(<span class="keywordtype">double</span> *)CBT2;
<a name="l00942"></a>00942         <span class="keywordtype">double</span> CBRT4 =*(<span class="keywordtype">double</span> *)CBT4;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944         <span class="keywordflow">if</span>( x == 0 )
<a name="l00945"></a>00945                 <span class="keywordflow">return</span>( 0.0 );
<a name="l00946"></a>00946         <span class="keywordflow">if</span>( x &gt; 0 )
<a name="l00947"></a>00947                 sign = 1;
<a name="l00948"></a>00948         <span class="keywordflow">else</span>{
<a name="l00949"></a>00949                 sign = -1;
<a name="l00950"></a>00950                 x = -x;
<a name="l00951"></a>00951         }
<a name="l00952"></a>00952 
<a name="l00953"></a>00953         z = x;
<a name="l00954"></a>00954         <span class="comment">/* extract power of 2, leaving</span>
<a name="l00955"></a>00955 <span class="comment">         * mantissa between 0.5 and 1 */</span>
<a name="l00956"></a>00956         x = frexp( x, &amp;e );
<a name="l00957"></a>00957 
<a name="l00958"></a>00958         <span class="comment">/* Approximate cube root of number between .5 and 1,</span>
<a name="l00959"></a>00959 <span class="comment">         * peak relative error = 6.36e-4 */</span>
<a name="l00960"></a>00960         x = (-1.9150215751434832257e-1  * x
<a name="l00961"></a>00961             + 6.9757045195246484393e-1) * x
<a name="l00962"></a>00962             + 4.9329566506409572486e-1;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964         <span class="comment">/* exponent divided by 3 */</span>
<a name="l00965"></a>00965         <span class="keywordflow">if</span>( e &gt;= 0 ){
<a name="l00966"></a>00966                 rem = e;
<a name="l00967"></a>00967                 e /= 3;
<a name="l00968"></a>00968                 rem -= 3*e;
<a name="l00969"></a>00969                 <span class="keywordflow">if</span>( rem == 1 )
<a name="l00970"></a>00970                         x *= CBRT2;
<a name="l00971"></a>00971                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rem == 2 )
<a name="l00972"></a>00972                         x *= CBRT4;
<a name="l00973"></a>00973         }<span class="keywordflow">else</span>{                                          <span class="comment">// argument less than 1</span>
<a name="l00974"></a>00974                 e = -e;
<a name="l00975"></a>00975                 rem = e;
<a name="l00976"></a>00976                 e /= 3;
<a name="l00977"></a>00977                 rem -= 3*e;
<a name="l00978"></a>00978                 <span class="keywordflow">if</span>( rem == 1 )
<a name="l00979"></a>00979                         x /= CBRT2;
<a name="l00980"></a>00980                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rem == 2 )
<a name="l00981"></a>00981                         x /= CBRT4;
<a name="l00982"></a>00982                 e = -e;
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985         x = ldexp( x, e );                      <span class="comment">// multiply by power of 2</span>
<a name="l00986"></a>00986 
<a name="l00987"></a>00987         x -= ( x - (z/(x*x)) )/3.0;     <span class="comment">// Newton iteration...</span>
<a name="l00988"></a>00988         x -= ( x - (z/(x*x)) )/3.0;
<a name="l00989"></a>00989         x -= ( x - (z/(x*x)) )/3.0;
<a name="l00990"></a>00990 
<a name="l00991"></a>00991         <span class="keywordflow">if</span>( sign &lt; 0 )
<a name="l00992"></a>00992                 x = -x;
<a name="l00993"></a>00993         <span class="keywordflow">return</span>(x);
<a name="l00994"></a>00994 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Apr 24 11:09:35 2008 for Jamoma by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
