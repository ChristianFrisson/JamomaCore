max v2;#N vpatcher 311 173 845 612;#P origin -84 11;#P window setfont "Sans Serif" 9.;#P newex 22 243 157 196617 jcom.oscroute /noise /threshold;#P toggle 22 316 15 0;#P toggle 95 287 15 0;#N vpatcher 52 59 294 291;#N comlet threshold;#P inlet 168 30 15 0;#N comlet video out;#P outlet 50 180 15 0;#P window setfont "Sans Serif" 9.;#P flonum 168 84 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P newex 50 69 27 196617 + 1;#P toggle 50 50 15 0;#P newex 50 90 47 196617 gate 2 2;#P newex 87 118 112 196617 jit.op @op > @val 0.05;#N comlet video;#P inlet 87 30 15 0;#N comlet on-off;#P inlet 50 30 15 0;#P connect 0 0 4 0;#P connect 4 0 5 0;#P connect 5 0 3 0;#P fasten 2 0 7 0 92 157 55 157;#P connect 3 0 7 0;#P connect 1 0 3 1;#P connect 3 1 2 0;#P fasten 6 0 2 0 173 112 92 112;#P connect 8 0 6 0;#P pop;#P newobj 95 310 60 196617 p threshold;#P comment 38 381 75 196617 VIDEO OUTPUT;#N comlet Video output;#P outlet 22 381 15 0;#N vpatcher 498 44 876 389;#N comlet threshold;#P inlet 230 30 15 0;#P window setfont "Sans Serif" 9.;#P window linecount 0;#P newex 50 69 27 196617 + 1;#P toggle 50 50 15 0;#P newex 50 90 47 196617 gate 2 1;#N comlet video;#P inlet 87 30 15 0;#N comlet on-off;#P inlet 50 30 15 0;#P outlet 50 298 15 0;#P number 106 131 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P message 106 149 48 196617 range \$1;#P flonum 159 131 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P flonum 217 131 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P message 217 149 41 196617 ring \$1;#P message 159 149 52 196617 center \$1;#P flonum 265 131 47 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P message 265 149 49 196617 ripple \$1;#P window linecount 1;#P comment 272 205 52 196617 Threshold;#P number 230 203 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P newex 87 229 105 196617 jit.op @op > @val 125;#P newex 87 179 145 196617 jit.fastblur @range 3 @mode 4;#P connect 13 0 16 0;#P connect 16 0 17 0;#P connect 17 0 15 0;#P connect 1 0 12 0;#P connect 15 0 12 0;#P connect 14 0 15 1;#P fasten 6 0 0 0 164 171 92 171;#P fasten 7 0 0 0 222 171 92 171;#P fasten 10 0 0 0 111 171 92 171;#P fasten 4 0 0 0 270 171 92 171;#P connect 15 1 0 0;#P connect 0 0 1 0;#P connect 11 0 10 0;#P connect 9 0 6 0;#P fasten 2 0 1 1 235 223 187 223;#P lcolor 1;#P connect 8 0 7 0;#P connect 18 0 2 0;#P connect 5 0 4 0;#P pop;#P newobj 22 347 88 196617 p noise-reduction;#N vpatcher 215 44 520 353;#P origin -73 0;#P window setfont "Sans Serif" 9.;#P window linecount 3;#P comment 113 169 129 196617 storing the background image and subtracting it from the incoming matrix.;#P window linecount 1;#P comment 165 119 97 196617 Finding the average;#P window linecount 0;#P newex 97 117 61 196617 cv.jit.mean;#P outlet 44 242 15 0;#P inlet 44 43 15 0;#P newex 44 170 63 196617 jit.op @op -;#P connect 1 0 0 0;#P connect 0 0 2 0;#P connect 1 0 3 0;#P connect 3 0 0 1;#P pop;#P newobj 386 155 56 196617 p adaptive;#N vpatcher 215 44 626 358;#P origin -73 0;#P window setfont "Sans Serif" 9.;#P window linecount 3;#P comment 113 169 129 196617 storing the background image and subtracting it from the incoming matrix.;#P window linecount 1;#P comment 127 99 90 196617 Record background;#P window linecount 4;#P comment 296 120 78 196617 Applying a little blur filtering to the background image;#P inlet 14 43 15 0;#P toggle 97 98 15 0;#P window linecount 0;#P newex 97 117 27 196617 gate;#P outlet 44 242 15 0;#P inlet 44 43 15 0;#P newex 44 170 63 196617 jit.op @op -;#P connect 1 0 0 0;#P connect 0 0 2 0;#P connect 5 0 4 0;#P connect 4 0 3 0;#P connect 3 0 0 1;#P fasten 1 0 3 1 49 92 119 92;#P pop;#P newobj 93 155 103 196617 p simple-subtraction;#P comment 281 39 75 196617 IMAGE INPUT;#N comlet Video input;#P inlet 359 39 15 0;#P toggle 119 117 15 0;#P number 186 90 27 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P newex 186 111 267 196617 gate 4 2;#N vpatcher 752 83 1451 698;#P origin -69 121;#P window setfont "Sans Serif" 9.;#P window linecount 1;#P comment 380 56 243 196617 Reducing the size of the matrix to save some power;#P comment 380 79 204 196617 Changing colour space used for calculations;#P window linecount 0;#P comment 330 368 149 196617 Converting back to char;#P newex 183 368 125 196617 jit.matrix 1 char 160 120;#P flonum 285 321 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P flonum 354 216 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P message 354 238 73 196617 slide_down \$1;#P flonum 291 216 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P message 291 238 60 196617 slide_up \$1;#P newex 258 267 190 196617 jit.slide @slide_up 10. @slide_down 10.;#P inlet 145 31 15 0;#P user com 520 164 97 196617 41;#K set 0 21608 26995 8304 24948 25448 8297 29472 25185 29541 25632 28526 8289 8304 24948 25448 8290 31008 19045 24942 11597 24946 25376 20581 27756 25972 26981 29184 8294 29295 27936 29800 25888 25462 11882 26996 11619 28524 27749 25460 26991 28206;#K end;#P window linecount 3;#P comment 265 482 93 196617 Multiply input image by foreground mask.;#P window linecount 1;#P comment 322 425 52 196617 Threshold;#P window linecount 3;#P comment 392 403 143 196617 <- Blur followed by a threshold gets rid of some noise and smoothes the image.;#P window linecount 1;#P comment 276 297 115 196617 Input - background mean;#P comment 330 340 189 196617 Foreground mask before noise reduction;#P comment 380 130 119 196617 Using float for accuracy;#P number 282 424 35 9 0 0 0 3 0 0 0 221 221 221 222 222 222 0 0 0;#P newex 183 518 74 196617 jit.op @op *;#P newex 183 495 64 196617 jit.matrix in;#P newex 183 473 74 196617 t b l;#P newex 183 444 109 196617 jit.op @op > @val 100;#P newex 183 396 145 196617 jit.fastblur @range 3 @mode 4;#P newex 190 107 66 196617 jit.unpack;#P newex 190 85 178 196617 jit.colorspace @input rgb @output YIQ;#P newex 183 340 112 196617 jit.op @op > @val 0.05;#P newex 218 130 140 196617 jit.matrix 1 float32 160 120;#P newex 183 297 85 196617 jit.op @op absdiff;#P window linecount 2;#P comment 11 155 127 196617 0: Record background info. 1: Identify foreground;#P toggle 145 157 15 0;#P window linecount 1;#P newex 183 182 27 196617 + 1;#P newex 183 203 45 196617 gate 2 1;#P newex 190 62 138 196617 jit.matrix in 4 char 160 120;#P comment 296 447 85 196617 Foreground mask;#P outlet 183 553 15 0;#P inlet 190 34 15 0;#P window linecount 2;#P comment 458 270 143 196617 Adding an IIR filter to smooth out the background image.;#P connect 27 0 7 0;#P fasten 7 0 6 0 150 180 188 180;#P connect 6 0 5 0;#P connect 5 1 9 0;#P lcolor 8;#P connect 9 0 11 0;#P connect 11 0 34 0;#P connect 34 0 14 0;#P connect 14 0 15 0;#P connect 15 0 16 0;#P connect 16 0 17 0;#P connect 17 0 18 0;#P connect 18 0 2 0;#P connect 1 0 4 0;#P connect 4 0 12 0;#P connect 12 0 13 0;#P connect 13 2 10 0;#P connect 10 0 5 1;#P connect 16 1 18 1;#P connect 5 0 28 0;#P fasten 31 0 28 0 359 265 263 265;#P fasten 29 0 28 0 296 261 263 261;#P connect 28 0 9 1;#P connect 19 0 15 1;#P lcolor 1;#P connect 33 0 11 1;#P connect 30 0 29 0;#P connect 32 0 31 0;#P pop;#P newobj 306 155 60 196617 p statistics;#N vpatcher 215 44 626 358;#P origin -73 0;#P window setfont "Sans Serif" 9.;#P window linecount 3;#P comment 113 169 129 196617 storing the background image and subtracting it from the incoming matrix.;#P window linecount 1;#P comment 127 99 90 196617 Record background;#P window linecount 4;#P comment 296 120 78 196617 Applying a little blur filtering to the background image;#P window linecount 1;#P newex 97 140 190 196617 jit.slide @slide_up 10. @slide_down 10.;#P inlet 14 43 15 0;#P toggle 97 98 15 0;#P window linecount 0;#P newex 97 117 27 196617 gate;#P outlet 44 242 15 0;#P inlet 44 43 15 0;#P newex 44 170 63 196617 jit.op @op -;#P connect 1 0 0 0;#P connect 0 0 2 0;#P connect 5 0 4 0;#P connect 4 0 3 0;#P connect 3 0 6 0;#P connect 6 0 0 1;#P fasten 1 0 3 1 49 92 119 92;#P pop;#P newobj 199 155 95 196617 p slide-subtraction;#P newex 186 217 54 196617 jcom.thru;#P newex 119 60 145 196617 jcom.oscroute /record /mode;#P comment 136 39 75 196617 INSTRUCTIONS;#N comlet Instructions;#P inlet 119 39 15 0;#P comment 406 39 75 196617 VIDEO INPUT;#N comlet Video input;#P inlet 484 39 15 0;#P fasten 4 2 21 0 258 82 274 82 274 32 27 32;#P connect 21 0 20 0;#P connect 20 0 15 0;#P connect 15 0 16 0;#P fasten 18 0 15 1 100 337 66 337;#P connect 10 0 13 0;#P connect 21 1 19 0;#P connect 19 0 18 0;#P connect 2 0 4 0;#P connect 4 0 10 0;#P fasten 5 0 18 1 191 301 125 301;#P connect 4 1 9 0;#P connect 9 0 8 0;#P connect 8 0 13 1;#P fasten 7 0 5 0 311 191 191 191;#P fasten 6 0 5 0 204 191 191 191;#P fasten 13 0 5 0 98 191 191 191;#P fasten 14 0 5 0 391 202 191 202;#P connect 10 0 6 0;#P connect 8 1 6 1;#P connect 10 0 7 0;#P connect 8 2 7 1;#P connect 8 3 14 0;#P fasten 0 0 8 1 489 107 448 107;#P pop;